<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-getting-started/install-lower-layer-system/faqs" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">FAQs | Dayu</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://dayu-autostreamer.github.io/zh/img/dayu_logo_all.png"><meta data-rh="true" name="twitter:image" content="https://dayu-autostreamer.github.io/zh/img/dayu_logo_all.png"><meta data-rh="true" property="og:url" content="https://dayu-autostreamer.github.io/zh/docs/getting-started/install-lower-layer-system/faqs"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="FAQs | Dayu"><meta data-rh="true" name="description" content="问题一：kube-proxy 报 iptables 问题"><meta data-rh="true" property="og:description" content="问题一：kube-proxy 报 iptables 问题"><link data-rh="true" rel="icon" href="/zh/img/dayu-logo.png"><link data-rh="true" rel="canonical" href="https://dayu-autostreamer.github.io/zh/docs/getting-started/install-lower-layer-system/faqs"><link data-rh="true" rel="alternate" href="https://dayu-autostreamer.github.io/docs/getting-started/install-lower-layer-system/faqs" hreflang="en"><link data-rh="true" rel="alternate" href="https://dayu-autostreamer.github.io/zh/docs/getting-started/install-lower-layer-system/faqs" hreflang="zh"><link data-rh="true" rel="alternate" href="https://dayu-autostreamer.github.io/docs/getting-started/install-lower-layer-system/faqs" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Dayu RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Dayu Atom Feed"><link rel="stylesheet" href="/zh/assets/css/styles.3be8bcf9.css">
<script src="/zh/assets/js/runtime~main.02075730.js" defer="defer"></script>
<script src="/zh/assets/js/main.65a0f340.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/zh/img/dayu.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/dayu.png" alt="Dayu Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zh/img/dayu.png" alt="Dayu Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/docs/introduction/why-dayu">文档</a><a class="navbar__item navbar__link" href="/zh/blog">博客</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh/docs/getting-started/install-lower-layer-system/faqs">Next</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/getting-started/install-lower-layer-system/faqs" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/docs/getting-started/install-lower-layer-system/faqs" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">简体中文</a></li></ul></div><a href="https://github.com/dayu-autostreamer/dayu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/zh/docs/introduction/why-dayu">介绍</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/introduction/why-dayu">为什么选择大禹系统</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/zh/docs/architecture">系统架构</a><button aria-label="展开侧边栏分类 &#x27;系统架构&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/zh/docs/getting-started">快速开始</a><button aria-label="折叠侧边栏分类 &#x27;快速开始&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/getting-started/preparation">系统准备</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/zh/docs/getting-started/install-lower-layer-system">安装底层系统</a><button aria-label="折叠侧边栏分类 &#x27;安装底层系统&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/getting-started/install-lower-layer-system/pre-requisites">前置要求</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/getting-started/install-lower-layer-system/install-kubernetes">安装Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/getting-started/install-lower-layer-system/install-kubeedge">安装KubeEdge</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/getting-started/install-lower-layer-system/install-edgemesh">安装EdgeMesh</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/getting-started/install-lower-layer-system/install-sedna">安装Sedna</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/getting-started/install-lower-layer-system/install-nvidia-gpu-support">安装NVIDIA GPU支持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/docs/getting-started/install-lower-layer-system/faqs">FAQs</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/zh/docs/getting-started/start-upper-layer-system">启动上层系统</a><button aria-label="展开侧边栏分类 &#x27;启动上层系统&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/zh/docs/developer-guide">开发者指南</a><button aria-label="展开侧边栏分类 &#x27;开发者指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/zh/docs/category/community">社区</a><button aria-label="展开侧边栏分类 &#x27;社区&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh/docs/getting-started"><span itemprop="name">快速开始</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh/docs/getting-started/install-lower-layer-system"><span itemprop="name">安装底层系统</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">FAQs</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>FAQs</h1></header>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题一kube-proxy-报-iptables-问题">问题一：kube-proxy 报 iptables 问题<a href="#问题一kube-proxy-报-iptables-问题" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">E0627 09:28:54.054930 1 proxier.go:1598] Failed to execute iptables-restore: exit status 1 (iptables-restore: line 86 failed ) I0627 09:28:54.054962 1 proxier.go:879] Sync failed; retrying in 30s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>解决：直接清理 iptables</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题二calico-和-coredns-一直处于初始化">问题二：calico 和 coredns 一直处于初始化<a href="#问题二calico-和-coredns-一直处于初始化" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>用 <code>kubectl describe &lt;podname&gt;</code> 应该会有 failed 的报错，大致内容是跟 network 和 sandbox 相关的</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Failed to create pod sandbox: rpc error: code = Unknown desc = [failed to set up sandbox container &quot;7f5b66ebecdfc2c206027a2afcb9d1a58ec5db1a6a10a91d4d60c0079236e401&quot; network for pod &quot;calico-kube-controllers-577f77cb5c-99t8z&quot;: networkPlugin cni failed to set up pod &quot;calico-kube-controllers-577f77cb5c-99t8z_kube-system&quot; network: error getting ClusterInformation: Get &quot;https://[10.96.0.1]:443/apis/crd.projectcalico.org/v1/clusterinformations/default&quot;: dial tcp 10.96.0. 1:443: i/o timeout, failed to clean up sandbox container &quot;7f5b66ebecdfc2c206027a2afcb9d1a58ec5db1a6a10a91d4d60c0079236e401&quot; network for pod &quot;calico-kube-controllers-577f77cb5c-99t8z&quot;: networkPlugin cni failed to teardown pod &quot;calico-kube-controllers-577f77cb5c-99t8z_kube-system&quot; network: error getting ClusterInformation: Get &quot;https://[10.96.0.1]:443/apis/crd.projectcalico.org/v1/clusterinformations/default&quot;: dial tcp 10.96.0. 1:443: i/o timeout]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>原因：应该不是第一次初始化 k8s 集群，所以会遇到这样的问题。出现的原因是之前没有删除 k8s 的网络配置（文档里的每一步都有它存在的意义...）</p>
<p>解决：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /etc/cni/net.d/  # 删除网络配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># maybe需要重新init一下</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题三metrics-server一直无法成功">问题三：metrics-server一直无法成功<a href="#问题三metrics-server一直无法成功" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>原因：master 没有加污点
解决：<code>kubectl taint nodes --all node-role.kubernetes.io/master node-role.kubernetes.io/master-</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题四10002-already-in-use">问题四：10002 already in use<a href="#问题四10002-already-in-use" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p><code>journalctl -u cloudcore.service -xe</code> 时看到 xxx already in use</p>
<p>原因：应该是之前的记录没有清理干净
解决：找到占用端口的进程，直接 Kill 即可</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lsof -i:xxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kill xxxxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题五edgecore-符号链接已存在">问题五：edgecore 符号链接已存在<a href="#问题五edgecore-符号链接已存在" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">execute keadm command failed:  failed to exec &#x27;bash -c sudo ln /etc/kubeedge/edgecore.service /etc/systemd/system/edgecore.service &amp;&amp; sudo systemctl daemon-reload &amp;&amp; sudo systemctl enable edgecore &amp;&amp; sudo systemctl start edgecore&#x27;, err: ln: failed to create hard link &#x27;/etc/systemd/system/edgecore.service&#x27;: File exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">, err: exit status 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在尝试创建符号链接时，目标路径已经存在，因此无法创建。这通常是因为 <code>edgecore.service</code> 已经存在于 <code>/etc/systemd/system/</code> 目录中</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo rm /etc/systemd/system/edgecore.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题六缺少-tlsstreamcertfile">问题六：缺少 TLSStreamCertFile<a href="#问题六缺少-tlsstreamcertfile" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> TLSStreamPrivateKeyFile: Invalid value: &quot;/etc/kubeedge/certs/stream.key&quot;: TLSStreamPrivateKeyFile not exist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12月 14 23:02:23 cloud.kubeedge cloudcore[196229]:   TLSStreamCertFile: Invalid value: &quot;/etc/kubeedge/certs/stream.crt&quot;: TLSStreamCertFile not exist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12月 14 23:02:23 cloud.kubeedge cloudcore[196229]:   TLSStreamCAFile: Invalid value: &quot;/etc/kubeedge/ca/streamCA.crt&quot;: TLSStreamCAFile not exist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12月 14 23:02:23 cloud.kubeedge cloudcore[196229]: ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看 <code>/etc/kubeedge</code> 下是否有 <code>certgen.sh</code> 并且 <code>bash certgen.sh stream</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题七edgemesh-的-log-边边互联成功云边无法连接">问题七：edgemesh 的 log 边边互联成功，云边无法连接<a href="#问题七edgemesh-的-log-边边互联成功云边无法连接" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="排查">排查<a href="#排查" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>先复习一下<strong>定位模型</strong>，确定<strong>被访问节点</strong>上的 edgemesh-agent(右)容器是否存在、是否处于正常运行中。</p>
<p><strong>这个情况是非常经常出现的</strong>，因为 master 节点一般都有污点，会驱逐其他 pod，进而导致 edgemesh-agent 部署不上去。这种情况可以通过去除节点污点，使 edgemesh-agent 部署上去解决。</p>
<p>如果访问节点和被访问节点的 edgemesh-agent 都正常启动了，但是还报这个错误，可能是因为访问节点和被访问节点没有互相发现导致，请这样排查：</p>
<ol>
<li>首先每个节点上的 edgemesh-agent 都具有 peer ID，比如</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">edge2: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I&#x27;m {12D3KooWPpY4GqqNF3sLC397fMz5ZZfxmtMTNa1gLYFopWbHxZDt: [/ip4/127.0.0.1/tcp/20006 /ip4/192.168.1.4/tcp/20006]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">edge1.kubeedge:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I&#x27;m {12D3KooWFz1dKY8L3JC8wAY6sJ5MswvPEGKysPCfcaGxFmeH7wkz: [/ip4/127.0.0.1/tcp/20006 /ip4/192.168.1.2/tcp/20006]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">注意：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a. peer ID是根据节点名称哈希出来的，相同的节点名称会哈希出相同的peer ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b. 另外，节点名称不是服务器名称，是k8s node name，请用kubectl get nodes查看</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2.如果访问节点和被访问节点处于同一个局域网内（<strong>所有节点应该具备内网 IP（10.0.0.0/8、172.16.0.0/12、192.168.0.0/16</strong>），请看<a href="https://zhuanlan.zhihu.com/p/585749690" target="_blank" rel="noopener noreferrer">全网最全EdgeMesh Q&amp;A手册 - 知乎 (zhihu.com)</a><strong>问题十二</strong>同一个局域网内 edgemesh-agent 互相发现对方时的日志是 <code>[MDNS] Discovery found peer: &lt;被访问端peer ID: [被访问端IP列表(可能会包含中继节点IP)]&gt;</code> ^d3939d</p>
<p>3.如果访问节点和被访问节点跨子网，这时候应该看看 relayNodes 设置的正不正确，为什么中继节点没办法协助两个节点交换 peer 信息。详细材料请阅读：<a href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/4whnkMM9oOaWRsI1ICsvSA" target="_blank" rel="noopener noreferrer">KubeEdge EdgeMesh 高可用架构详解</a>。跨子网的 edgemesh-agent 互相发现对方时的日志是 <code>[DHT] Discovery found peer: &lt;被访问端peer ID: [被访问端IP列表(可能会包含中继节点IP)]&gt;</code>（适用于我的情况）</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决">解决<a href="#解决" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>在部署 edgemesh 进行 <code>kubectl apply -f build/agent/resources/</code> 操作时，修改 04-configmap，添加 relayNode（根本原因在于，不符合“访问节点和被访问节点处于同一个局域网内”，所以需要添加 relayNode）</p>
<p><img decoding="async" loading="lazy" alt="Q7" src="/zh/assets/images/Q7-8146db94e6f201c47562da7a76cc6ab9.png" width="888" height="1081" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题八master-的gpu-存在但是找不到-gpu-资源">问题八：master 的gpu 存在但是找不到 gpu 资源<a href="#问题八master-的gpu-存在但是找不到-gpu-资源" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>主要针对的是服务器的情况，可以使用 <code>nvidia-smi</code> 查看显卡情况。</p>
<p>需要配置GPU支持</p>
<blockquote>
<p>[!quote]
<a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#configuration" target="_blank" rel="noopener noreferrer">Installing the NVIDIA Container Toolkit — NVIDIA Container Toolkit 1.14.3 documentation</a></p>
</blockquote>
<p>按上述内容进行配置，然后还需要 <code>vim /etc/docker/daemon.json</code>，添加 default-runtime。按照 quote 的内容设置后会有“runtimes”但是 default-runtime 不会设置，可能会导致找不到 GPU 资源</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;exec-opts&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;native.cgroupdriver=systemd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;registry-mirrors&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;https://b9pmyelo.mirror.aliyuncs.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;default-runtime&quot;: &quot;nvidia&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;runtimes&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;nvidia&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;args&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;path&quot;: &quot;nvidia-container-runtime&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题九jeston-的-gpu-存在但是找不到-gpu-资源">问题九：jeston 的 gpu 存在但是找不到 gpu 资源<a href="#问题九jeston-的-gpu-存在但是找不到-gpu-资源" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>理论上 <code>k8s-device-plugin</code> 已经支持了 tegra 即 jetson 系列板子，会在查看 GPU 之前判断是否是 tegra 架构，如果是则采用 tegra 下查看 GPU 的方式（原因在 [[#GPU 支持]]里 quote 过了 ），但是很奇怪的是明明是 tegra 的架构却没有检测到：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2024/01/04 07:43:58 Retreiving plugins.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024/01/04 07:43:58 Detected non-NVML platform: could not load NVML: libnvidia-ml.so.1: cannot open shared object file: No such file or directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024/01/04 07:43:58 Detected non-Tegra platform: /sys/devices/soc0/family file not found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024/01/04 07:43:58 Incompatible platform detected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024/01/04 07:43:58 If this is a GPU node, did you configure the NVIDIA Container Toolkit?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024/01/04 07:43:58 You can check the prerequisites at: https://github.com/NVIDIA/k8s-device-plugin#prerequisites</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024/01/04 07:43:58 You can learn how to set the runtime at: https://github.com/NVIDIA/k8s-device-plugin#quick-start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024/01/04 07:43:58 If this is not a GPU node, you should set up a toleration or nodeSelector to only deploy this plugin on GPU nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024/01/04 07:43:58 No devices found. Waiting indefinitely.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Q9-1" src="/zh/assets/images/Q9-1-7d0151af41d7e0fcc09e05810fef0580.png" width="1624" height="203" class="img_ev3q"></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ dpkg -l &#x27;*nvidia*&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Q9-2" src="/zh/assets/images/Q9-2-7da49098d112b131753b39531fdc55aa.png" width="1623" height="795" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="Q9-3" src="/zh/assets/images/Q9-3-591f4e53eb2b30e79c052d9cc8a342d2.png" width="1447" height="386" class="img_ev3q"></p>
<blockquote>
<p>[!quote]
<a href="https://github.com/NVIDIA/k8s-device-plugin/issues/377" target="_blank" rel="noopener noreferrer">Plug in does not detect Tegra device Jetson Nano · Issue #377 · NVIDIA/k8s-device-plugin (github.com)</a></p>
<p>Note that looking at the initial logs that you provided you may have been using <code>v1.7.0</code> of the NVIDIA Container Toolkit. This is quite an old version and we greatly improved our support for Tegra-based systems with the <code>v1.10.0</code> release. It should also be noted that in order to use the GPU Device Plugin on Tegra-based systems (specifically targetting the integrated GPUs) at least <code>v1.11.0</code> of the NVIDIA Container Toolkit is required.</p>
<p>There are no Tegra-specific changes in the <code>v1.12.0</code> release, so using the <code>v1.11.0</code> release should be sufficient in this case.</p>
</blockquote>
<p>那么应该需要升级<strong>NVIDIA Container Toolkit</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &amp;&amp; curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sed &#x27;s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g&#x27; | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install -y nvidia-container-toolkit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题十lc12700-5353-no-such-hostconnection-refused">问题十：lc127.0.0. 53:53 no such host/connection refused<a href="#问题十lc12700-5353-no-such-hostconnection-refused" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="问题描述">问题描述<a href="#问题描述" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>在安装Sedna阶段，检查正确性时报错lc127.0.0. 53:53 no such host/connection refused</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方法">解决方法<a href="#解决方法" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>错误原理参见：<a href="https://zhuanlan.zhihu.com/p/585749690" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/585749690</a>  链接中的问题五。</p>
<p>首先，检查准备阶段中的Sedna安装脚本install.sh，观察其中是否有Hostnetwork键值对，如果没有，一般说明不会有问题。</p>
<p>如果确认没有这个键值对却依然报错，按照如下方法暂时解决问题（不推荐）：</p>
<p>（1）在边/云（取决于是哪一个sedna的pod出问题了）用vim /etc/resolv.conf打开文件，然后在文件最后一行添加nameserver 169.254.96.16，哪怕文件中本来就有nameserver键。但是一般不推荐这样做。</p>
<p>（2）再去边端用vim /etc/kubeedge/config/edgecore.yam打开edgecore.yaml，查看edge部分的clusterDNS内是否对应169.254.96.16，有没有被覆盖。如果没覆盖就成功。</p>
<p>（3）在这之后，如果是边端上的pod出问题，就要重装sedna，先delete再create。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="原解决方法">原解决方法：<a href="#原解决方法" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>原因：解析 gm.sedna 这个域名失败</p>
<ol>
<li>如果安装 sedna 脚本有将 hostNetwork 去掉，则检查 edgecore.yaml 的 clusterDNS 部分，<strong>着重注意是否没有二次设置然后被后设置的覆盖掉</strong></li>
<li>如果没有将 hostNetwork 去掉，则将宿主机的 <code>/etc/resolv.conf</code> 添加 <code>nameserver 169.254.96.16</code></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题十一1692549616-such-host">问题十一：169.254.96.16<!-- -->:no<!-- --> such host<a href="#问题十一1692549616-such-host" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>检查 edgemesh 的配置是否正确：</p>
<ol>
<li>检查 iptables 的链的顺序如<a href="https://edgemesh.netlify.app/zh/advanced/hybird-proxy.html" target="_blank" rel="noopener noreferrer">混合代理 | EdgeMesh</a> 所示</li>
<li>着重检查 clusterDNS</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题十二-kubectl-logs-pod-name-超时">问题十二： <code>kubectl logs &lt;pod-name&gt;</code> 超时<a href="#问题十二-kubectl-logs-pod-name-超时" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Q12-1" src="/zh/assets/images/Q12-1-60f1a6a94ca2026686a35355f721293d.png" width="1618" height="42" class="img_ev3q"></p>
<p>原因：借鉴 <a href="https://zhuanlan.zhihu.com/p/379962934" target="_blank" rel="noopener noreferrer">Kubernetes 边缘节点抓不到监控指标？试试这个方法！ - 知乎 (zhihu.com)</a></p>
<p><img decoding="async" loading="lazy" alt="Q12-2" src="/zh/assets/images/Q12-2-f993592abf40687d45bb005fd2b6ed1c.png" width="896" height="428" class="img_ev3q"></p>
<p>可以发现报错访问的端口就是 10350，而在 kubeedge 中 10350 应该会进行转发，所以应该是 cloudcore 的设置问题。</p>
<p>解决：<a href="https://kubeedge.io/docs/advanced/debug/" target="_blank" rel="noopener noreferrer">Enable Kubectl logs/exec to debug pods on the edge | KubeEdge</a> 根据这个链接设置即可。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题十三-kubectl-logs-pod-name-卡住">问题十三： <code>kubectl logs &lt;pod-name&gt;</code> 卡住<a href="#问题十三-kubectl-logs-pod-name-卡住" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>可能的原因：之前 <code>kubectl logs</code> 时未结束就 ctrl+c 结束了导致后续卡住
解决：重启 edgecore/cloudcore <code>systemctl restart edgecore.service</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题十四cloudcore报certficate错误">问题十四：CloudCore报certficate错误<a href="#问题十四cloudcore报certficate错误" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Q14" src="/zh/assets/images/Q14-6d45356896d3c46128f949c4ca662ba4.png" width="1628" height="310" class="img_ev3q"></p>
<p>原因：因为是重装，主节点 token 变了，但是边缘节点一直以过去的 token 尝试进行连接</p>
<p>解决：边端用新的 token 连接就好</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题十五删除命名空间卡在-terminating">问题十五：删除命名空间卡在 terminating<a href="#问题十五删除命名空间卡在-terminating" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>理论上一直等待应该是可以的(但是我等了半个钟也没成功啊!!)
<strong>方法一</strong>，但是没啥用，依旧卡住</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete ns sedna --force --grace-period=0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>方法二</strong>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">开启一个代理终端</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting to serve on 127.0.0.1:8001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">再开启一个操作终端</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">将test namespace的配置文件输出保存</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get ns sedna -o json &gt; sedna.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">删除spec及status部分的内容还有metadata字段后的&quot;,&quot;号，切记！</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">剩下内容大致如下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">guest@cloud:~/yby$ cat sedna.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;apiVersion&quot;: &quot;v1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;kind&quot;: &quot;Namespace&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;metadata&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;creationTimestamp&quot;: &quot;2023-12-14T09:12:13Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;deletionTimestamp&quot;: &quot;2023-12-14T09:15:25Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;managedFields&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;apiVersion&quot;: &quot;v1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;fieldsType&quot;: &quot;FieldsV1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;fieldsV1&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;f:status&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;f:phase&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;manager&quot;: &quot;kubectl-create&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;operation&quot;: &quot;Update&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;time&quot;: &quot;2023-12-14T09:12:13Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;apiVersion&quot;: &quot;v1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;fieldsType&quot;: &quot;FieldsV1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;fieldsV1&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;f:status&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;f:conditions&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &quot;.&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &quot;k:{\&quot;type\&quot;:\&quot;NamespaceContentRemaining\&quot;}&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;.&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:lastTransitionTime&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:message&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:reason&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:status&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:type&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &quot;k:{\&quot;type\&quot;:\&quot;NamespaceDeletionContentFailure\&quot;}&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;.&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:lastTransitionTime&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:message&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:reason&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:status&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:type&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &quot;k:{\&quot;type\&quot;:\&quot;NamespaceDeletionDiscoveryFailure\&quot;}&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;.&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:lastTransitionTime&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:message&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:reason&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:status&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:type&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &quot;k:{\&quot;type\&quot;:\&quot;NamespaceDeletionGroupVersionParsingFailure\&quot;}&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;.&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:lastTransitionTime&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:message&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:reason&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:status&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:type&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &quot;k:{\&quot;type\&quot;:\&quot;NamespaceFinalizersRemaining\&quot;}&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;.&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:lastTransitionTime&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:message&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:reason&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:status&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;f:type&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;manager&quot;: &quot;kube-controller-manager&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;operation&quot;: &quot;Update&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;time&quot;: &quot;2023-12-14T09:15:30Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;: &quot;sedna&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;resourceVersion&quot;: &quot;3351515&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;uid&quot;: &quot;99cb8afb-a4c1-45e6-960d-ff1b4894773d&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">调接口删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># curl -k -H &quot;Content-Type: application/json&quot; -X PUT --data-binary @sedna.json http://127.0.0.1:8001/api/v1/namespaces/sedna/finalize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;kind&quot;: &quot;Namespace&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;apiVersion&quot;: &quot;v1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;metadata&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;name&quot;: &quot;sedna&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;uid&quot;: &quot;99cb8afb-a4c1-45e6-960d-ff1b4894773d&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;resourceVersion&quot;: &quot;3351515&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;creationTimestamp&quot;: &quot;2023-12-14T09:12:13Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;deletionTimestamp&quot;: &quot;2023-12-14T09:15:25Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;managedFields&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;manager&quot;: &quot;curl&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;operation&quot;: &quot;Update&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;apiVersion&quot;: &quot;v1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;time&quot;: &quot;2023-12-14T09:42:38Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;fieldsType&quot;: &quot;FieldsV1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;fieldsV1&quot;: {&quot;f:status&quot;:{&quot;f:phase&quot;:{}}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;spec&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;status&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;phase&quot;: &quot;Terminating&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;conditions&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;NamespaceDeletionDiscoveryFailure&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;status&quot;: &quot;True&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;lastTransitionTime&quot;: &quot;2023-12-14T09:15:30Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;reason&quot;: &quot;DiscoveryFailed&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;message&quot;: &quot;Discovery failed for some groups, 1 failing: unable to retrieve the complete list of server APIs: metrics.k8s.io/v1beta1: the server is currently unable to handle the request&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;NamespaceDeletionGroupVersionParsingFailure&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;status&quot;: &quot;False&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;lastTransitionTime&quot;: &quot;2023-12-14T09:15:30Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;reason&quot;: &quot;ParsedGroupVersions&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;message&quot;: &quot;All legacy kube types successfully parsed&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;NamespaceDeletionContentFailure&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;status&quot;: &quot;False&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;lastTransitionTime&quot;: &quot;2023-12-14T09:15:30Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;reason&quot;: &quot;ContentDeleted&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;message&quot;: &quot;All content successfully deleted, may be waiting on finalization&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;NamespaceContentRemaining&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;status&quot;: &quot;False&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;lastTransitionTime&quot;: &quot;2023-12-14T09:15:30Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;reason&quot;: &quot;ContentRemoved&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;message&quot;: &quot;All content successfully removed&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;NamespaceFinalizersRemaining&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;status&quot;: &quot;False&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;lastTransitionTime&quot;: &quot;2023-12-14T09:15:30Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;reason&quot;: &quot;ContentHasNoFinalizers&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;message&quot;: &quot;All content-preserving finalizers finished&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题十六强制删除-pod-之后部署不成功">问题十六：强制删除 pod 之后部署不成功<a href="#问题十六强制删除-pod-之后部署不成功" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="问题描述-1">问题描述<a href="#问题描述-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>因为现在 edge 的 pod 是通过创建 deployment 由 deployment 进行创建，但是通过 <code>kubectl delete deploy &lt;deploy-name&gt;</code> 删除 deployment 后，pod 一直卡在了 terminating 状态，于是采用了 <code>kubectl delete pod edgeworker-deployment-7g5hs-58dffc5cd7-b77wz --force --grace-period=0</code> 命令进行了删除。
然后发现重新部署时候发现 assigned to edge 的 pod 都卡在 pending 状态。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决-1">解决<a href="#解决-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>因为--force 是不会实际终止运行的，所以本身原来的 docker 可能还在运行，现在的做法是手动去对应的边缘节点上删除对应的容器（包括 pause，关于 pause 可以看这篇文章<a href="https://zhuanlan.zhihu.com/p/464712164" target="_blank" rel="noopener noreferrer">大白话 K8S（03）：从 Pause 容器理解 Pod 的本质 - 知乎 (zhihu.com)</a>），然后重启 edgecore: <code>systemctl restart edgecore.service</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题十七删除-deploymentpod-等容器依旧自动重启">问题十七：删除 deployment、pod 等，容器依旧自动重启<a href="#问题十七删除-deploymentpod-等容器依旧自动重启" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> journalctl -u edgecore.service  -f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Q17" src="/zh/assets/images/Q17-669c6d2f79f3164af4465da5421337b5.png" width="1557" height="148" class="img_ev3q"></p>
<p>解决：重启 edgecore</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart edgecore.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题十八大面积-evicteddisk-pressure">问题十八：大面积 Evicted（disk pressure）<a href="#问题十八大面积-evicteddisk-pressure" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="原因">原因<a href="#原因" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<ul>
<li>
<p>node 上的 kubelet 负责采集资源占用数据，并和预先设置的 threshold 值进行比较，如果超过 threshold 值，kubelet 会杀掉一些 Pod 来回收相关资源，<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fkubernetes.io%2Fdocs%2Ftasks%2Fadminister-cluster%2Fout-of-resource%2F" target="_blank" rel="noopener noreferrer">K8sg官网解读kubernetes配置资源不足处理</a></p>
</li>
<li>
<p>默认启动时，node 的可用空间低于15%的时候，该节点上讲会执行 eviction 操作，由于磁盘已经达到了85%,在怎么驱逐也无法正常启动就会一直重启，Pod 状态也是 pending 中</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="临时解决方法">临时解决方法<a href="#临时解决方法" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<ul>
<li>修改配置文件增加传参数,添加此配置项<code>--eviction-hard=nodefs.available&lt;5%</code></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@cloud:/usr/lib/systemd/system# systemctl status kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">● kubelet.service - kubelet: The Kubernetes Node Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Drop-In: /etc/systemd/system/kubelet.service.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             └─10-kubeadm.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Active: active (running) since Fri 2023-12-15 09:17:50 CST; 5min ago</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       Docs: https://kubernetes.io/docs/home/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Main PID: 1070209 (kubelet)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tasks: 59 (limit: 309024)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Memory: 67.2M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     CGroup: /system.slice/kubelet.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到配置文件目录所在位置是 <code>/etc/systemd/system/kubelet.service.d</code>，配置文件是 <code>10-kubeadm.conf</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/systemd/system/kubelet.service.d/10-kubeadm.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Environment=&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Environment=&quot;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml --eviction-hard=nodefs.available&lt;5%&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">最后添加上--eviction-hard=nodefs.available&lt;5%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后重启 kubelet</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl  restart kubelet</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>会发现可以正常部署了(只是应急措施，磁盘空间需要再清理)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题十九执行iptables-命令时发现系统不支持--dport选项">问题十九：执行iptables 命令时发现系统不支持--dport选项。<a href="#问题十九执行iptables-命令时发现系统不支持--dport选项" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="问题描述-2">问题描述<a href="#问题描述-2" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>执行命令：iptables -t nat -A OUTPUT -p tcp --dport 10351 -j DNAT --to $CLOUDCOREIPS:10003</p>
<p>报错信息中指出系统不支持--dport选项，这是因为iptables版本不支持。</p>
<p>使用iptables -V查看版本，如果是iptables v1.8.7 (nf_tables)，说明问题出在这里，因为nf_tables版本不支持--dport选项。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方法-1">解决方法<a href="#解决方法-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>此时，使用sudo update-alternatives --config iptables命令可以切换版本，执行此命令会提供3个可供选择的版本，其中编号为1的就是legacy版本（必须用sudo权限才能切换成功）。切换成功后再在root模式下执行 iptables -t nat -A OUTPUT -p tcp --dport 10351 -j DNAT --to $CLOUDCOREIPS:10003，理想状态下无输出。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题二十执行完keadm-join再执行journalctl时报错token-format错误">问题二十：执行完keadm join再执行journalctl时报错token format错误。<a href="#问题二十执行完keadm-join再执行journalctl时报错token-format错误" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="问题描述-3">问题描述<a href="#问题描述-3" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>执行命令：keadm join --cloudcore-ipport=114.212.81.11:10000 --kubeedge-version=1.9.2 --token=……之后，再执行journalctl -u edegecore.service -f命令后，报错信息指出token format有问题。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方法-2">解决方法<a href="#解决方法-2" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>此时要么是因为cloudcore.service重启后token变化导致keadm join中的token过时，要么是因为执行keadm join的时候token输入的不对。此时，首先在云端重新获取正确的token，然后在边端从keadm reset开始重新执行一系列操作。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题二十一重启edgecoreservice后再执行journalctl时报错mapping-error">问题二十一：重启edgecore.service后再执行journalctl时报错mapping error<a href="#问题二十一重启edgecoreservice后再执行journalctl时报错mapping-error" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="问题描述-4">问题描述<a href="#问题描述-4" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>在执行EdgeMesh启动阶段，修改/etc/kubeedge/config/edgecore.yaml文件，再用systemctl restart edgecore.service重启服务，然后再执行journalctl -u edegecore.service -f命令后，报错信息指出当前存在mapping error，以及yaml无法转化为json。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方法-3">解决方法<a href="#解决方法-3" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>检查是不是/etc/kubeedge/config/edgecore.yaml文件内的格式有问题。yaml文件中不能用tab缩进，必需用空格。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题二十二重启edgecoreservice后再执行journalctl时报错connect-refuse">问题二十二：重启edgecore.service后再执行journalctl时报错connect refuse<a href="#问题二十二重启edgecoreservice后再执行journalctl时报错connect-refuse" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="问题描述-5">问题描述<a href="#问题描述-5" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>在执行EdgeMesh启动阶段，修改/etc/kubeedge/config/edgecore.yaml文件，再用systemctl restart edgecore.service重启服务，然后再执行journalctl -u edegecore.service -f命令后，报错信息指出connect refuse，云端拒绝通信。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方法-4">解决方法<a href="#解决方法-4" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>检查是不是因为云端cloudcore有问题。首先用systemctl status cloudcore查看云端状态，确保其正常运行；然后用systemctl restart cloudcore.service重启服务，并在重启后journalctl -u cloudcore.service -f查看报错信息。此时，很有可能发现问题四：journalclt -u cloudcore.service -xe 时看到 xxx already in use
原因：应该是之前的记录没有清理干净（一般是占用了10002端口）
解决：找到占用端口的进程，直接 Kill 即可
lsof -i<!-- -->:xxxx<!-- -->
kill xxxxx</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题二十三部署metrics-service时遇到shutting-down相关问题">问题二十三：部署metrics-service时遇到Shutting down相关问题<a href="#问题二十三部署metrics-service时遇到shutting-down相关问题" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="问题描述-6">问题描述<a href="#问题描述-6" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>部署metrics-service过程中按照文档中修改components.yaml文件中端口号为4443，而后续metrics-service运行失败，
产生Shutting down RequestHeaderAuthRequestController等相关错误。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方法-5">解决方法<a href="#解决方法-5" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>在部署kubeedge时，metrics-service参数中暴露的端口会被自动覆盖为10250端口，components.yaml文件中后续实际服务
所在的端口一致。也可以手动修改参数中的端口为10250即可。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题二十四16925496-1653-io-timeout">问题二十四：169.254.96. 16:53: i/o timeout<a href="#问题二十四16925496-1653-io-timeout" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="问题描述-7">问题描述<a href="#问题描述-7" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>集群新加入节点，KubeEdge的edgemesh以及sedna等组件会自动部署。查看lc的log会发现报错</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">client tries to connect global manager(address: gm.sedna:9000) failed, error: dial tcp: lookup gm.sedna on 169.254.96.16:53: read udp 172.17.0.3:49991-&gt;169.254.96.16:53: i/o timeout</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方法-6">解决方法<a href="#解决方法-6" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>由于是pod与edgemesh-agent的交互问题，首先检查该edge上的edgemesh-agent的状态，发现会是edgemesh-agent的问题。
<img decoding="async" loading="lazy" alt="Q24-1" src="/zh/assets/images/Q24-1-b02734af65fce88ec4459259d817bc36.png" width="1009" height="163" class="img_ev3q"></p>
<p>通过describe pod发现该pod被分配到新edge后就没有其余事件记录</p>
<p><img decoding="async" loading="lazy" alt="Q24-2" src="/zh/assets/images/Q24-2-b2316d2cf4ee1288f5324df9a0da9876.png" width="1082" height="275" class="img_ev3q"></p>
<p>可以去edge上查看信息。通过<code>journalctl -u edgecore.service -xe</code>可以看到相关报错</p>
<p><img decoding="async" loading="lazy" alt="Q24-3" src="/zh/assets/images/Q24-3-af894ddc03e47d6514186c0bb7f079ba.png" width="1544" height="127" class="img_ev3q"></p>
<p>原因：docker国内无法访问，新加入的edge没有做对应配置，导致拉取不到 kubeedge/edgemesh-agent 镜像。配置后重启docker和edgecore即可。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题二十五边端join报错">问题二十五：边端join报错<a href="#问题二十五边端join报错" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="问题描述-8">问题描述<a href="#问题描述-8" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>边端执行keadm join报错</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方法-7">解决方法<a href="#解决方法-7" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>检查edgecore.yaml文件</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/kubeedge/config/edgecore.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Q25" src="/zh/assets/images/Q25-dc68c2dfac16a206d5fd83e3a9d1ba11.png" width="684" height="365" class="img_ev3q"></p>
<p>edgeHub中的httpServer添加云端地址，例如<a href="https://114.212.81.11:10002" target="_blank" rel="noopener noreferrer">https://114.212.81.11:10002</a> ，websocket中的server删除最开始的冒号</p>
<p>修改完后重新运行keadm join指令。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/docs/getting-started/install-lower-layer-system/install-nvidia-gpu-support"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">安装NVIDIA GPU支持</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/docs/getting-started/start-upper-layer-system"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Start Upper Layer System</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#问题一kube-proxy-报-iptables-问题" class="table-of-contents__link toc-highlight">问题一：kube-proxy 报 iptables 问题</a></li><li><a href="#问题二calico-和-coredns-一直处于初始化" class="table-of-contents__link toc-highlight">问题二：calico 和 coredns 一直处于初始化</a></li><li><a href="#问题三metrics-server一直无法成功" class="table-of-contents__link toc-highlight">问题三：metrics-server一直无法成功</a></li><li><a href="#问题四10002-already-in-use" class="table-of-contents__link toc-highlight">问题四：10002 already in use</a></li><li><a href="#问题五edgecore-符号链接已存在" class="table-of-contents__link toc-highlight">问题五：edgecore 符号链接已存在</a></li><li><a href="#问题六缺少-tlsstreamcertfile" class="table-of-contents__link toc-highlight">问题六：缺少 TLSStreamCertFile</a></li><li><a href="#问题七edgemesh-的-log-边边互联成功云边无法连接" class="table-of-contents__link toc-highlight">问题七：edgemesh 的 log 边边互联成功，云边无法连接</a></li><li><a href="#问题八master-的gpu-存在但是找不到-gpu-资源" class="table-of-contents__link toc-highlight">问题八：master 的gpu 存在但是找不到 gpu 资源</a></li><li><a href="#问题九jeston-的-gpu-存在但是找不到-gpu-资源" class="table-of-contents__link toc-highlight">问题九：jeston 的 gpu 存在但是找不到 gpu 资源</a></li><li><a href="#问题十lc12700-5353-no-such-hostconnection-refused" class="table-of-contents__link toc-highlight">问题十：lc127.0.0. 53:53 no such host/connection refused</a></li><li><a href="#问题十一1692549616-such-host" class="table-of-contents__link toc-highlight">问题十一：169.254.96.16 such host</a></li><li><a href="#问题十二-kubectl-logs-pod-name-超时" class="table-of-contents__link toc-highlight">问题十二： <code>kubectl logs &lt;pod-name&gt;</code> 超时</a></li><li><a href="#问题十三-kubectl-logs-pod-name-卡住" class="table-of-contents__link toc-highlight">问题十三： <code>kubectl logs &lt;pod-name&gt;</code> 卡住</a></li><li><a href="#问题十四cloudcore报certficate错误" class="table-of-contents__link toc-highlight">问题十四：CloudCore报certficate错误</a></li><li><a href="#问题十五删除命名空间卡在-terminating" class="table-of-contents__link toc-highlight">问题十五：删除命名空间卡在 terminating</a></li><li><a href="#问题十六强制删除-pod-之后部署不成功" class="table-of-contents__link toc-highlight">问题十六：强制删除 pod 之后部署不成功</a></li><li><a href="#问题十七删除-deploymentpod-等容器依旧自动重启" class="table-of-contents__link toc-highlight">问题十七：删除 deployment、pod 等，容器依旧自动重启</a></li><li><a href="#问题十八大面积-evicteddisk-pressure" class="table-of-contents__link toc-highlight">问题十八：大面积 Evicted（disk pressure）</a></li><li><a href="#问题十九执行iptables-命令时发现系统不支持--dport选项" class="table-of-contents__link toc-highlight">问题十九：执行iptables 命令时发现系统不支持--dport选项。</a></li><li><a href="#问题二十执行完keadm-join再执行journalctl时报错token-format错误" class="table-of-contents__link toc-highlight">问题二十：执行完keadm join再执行journalctl时报错token format错误。</a></li><li><a href="#问题二十一重启edgecoreservice后再执行journalctl时报错mapping-error" class="table-of-contents__link toc-highlight">问题二十一：重启edgecore.service后再执行journalctl时报错mapping error</a></li><li><a href="#问题二十二重启edgecoreservice后再执行journalctl时报错connect-refuse" class="table-of-contents__link toc-highlight">问题二十二：重启edgecore.service后再执行journalctl时报错connect refuse</a></li><li><a href="#问题二十三部署metrics-service时遇到shutting-down相关问题" class="table-of-contents__link toc-highlight">问题二十三：部署metrics-service时遇到Shutting down相关问题</a></li><li><a href="#问题二十四16925496-1653-io-timeout" class="table-of-contents__link toc-highlight">问题二十四：169.254.96. 16:53: i/o timeout</a></li><li><a href="#问题二十五边端join报错" class="table-of-contents__link toc-highlight">问题二十五：边端join报错</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/introduction/why-dayu">介绍</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/getting-started">教程</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/developer-guide">开发</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/dayu-autostreamer/dayu/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github Issue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/community/contributing">贡献代码</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/community/contact-us">联系我们</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/dayu-autostreamer/dayu" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 The Dayu Authors. All rights reserved.</div></div></div></footer></div>
</body>
</html>