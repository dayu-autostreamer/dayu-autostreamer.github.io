<!doctype html>
<html class="docs-version-current" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Dayu Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Dayu Blog Atom Feed"><title data-react-helmet="true">FAQs | Dayu</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/zh/docs/getting-start/faqs"><meta data-react-helmet="true" name="docusaurus_locale" content="zh"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="FAQs | Dayu"><meta data-react-helmet="true" name="description" content="问题一：kube-proxy 报 iptables 问题"><meta data-react-helmet="true" property="og:description" content="问题一：kube-proxy 报 iptables 问题"><link data-react-helmet="true" rel="shortcut icon" href="/zh/img/dayu-logo.png"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/zh/docs/getting-start/faqs"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/getting-start/faqs" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/zh/docs/getting-start/faqs" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/getting-start/faqs" hreflang="x-default"><link rel="stylesheet" href="/zh/assets/css/styles.3d55f3a0.css">
<link rel="preload" href="/zh/assets/js/runtime~main.eaeab0d0.js" as="script">
<link rel="preload" href="/zh/assets/js/main.c5dadaff.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><img src="/zh/img/dayu.png" alt="Dayu Site Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/zh/img/dayu.png" alt="Dayu Site Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"></a><a class="navbar__item navbar__link navbar__link--active" href="/zh/docs/introduction/why-dayu">Documentation</a><a class="navbar__item navbar__link" href="/zh/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/dayu-autostreamer/dayu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Instruction</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/getting-start/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/getting-start/preparation">Preparation</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/getting-start/installation">Installation</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/docs/getting-start/faqs">FAQs</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Developer Guide</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>FAQs</h1></header><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题一kube-proxy-报-iptables-问题"></a>问题一：kube-proxy 报 iptables 问题<a class="hash-link" href="#问题一kube-proxy-报-iptables-问题" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">E0627 09:28:54.054930 1 proxier.go:1598] Failed to execute iptables-restore: exit status 1 (iptables-restore: line 86 failed ) I0627 09:28:54.054962 1 proxier.go:879] Sync failed; retrying in 30s</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>解决：直接清理 iptables</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题二calico-和-coredns-一直处于初始化"></a>问题二：calico 和 coredns 一直处于初始化<a class="hash-link" href="#问题二calico-和-coredns-一直处于初始化" title="Direct link to heading">#</a></h3><p>用 <code>kubectl describe &lt;podname&gt;</code> 应该会有 failed 的报错，大致内容是跟 network 和 sandbox 相关的 </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">Failed to create pod sandbox: rpc error: code = Unknown desc = [failed to set up sandbox container &quot;7f5b66ebecdfc2c206027a2afcb9d1a58ec5db1a6a10a91d4d60c0079236e401&quot; network for pod &quot;calico-kube-controllers-577f77cb5c-99t8z&quot;: networkPlugin cni failed to set up pod &quot;calico-kube-controllers-577f77cb5c-99t8z_kube-system&quot; network: error getting ClusterInformation: Get &quot;https://[10.96.0.1]:443/apis/crd.projectcalico.org/v1/clusterinformations/default&quot;: dial tcp 10.96.0. 1:443: i/o timeout, failed to clean up sandbox container &quot;7f5b66ebecdfc2c206027a2afcb9d1a58ec5db1a6a10a91d4d60c0079236e401&quot; network for pod &quot;calico-kube-controllers-577f77cb5c-99t8z&quot;: networkPlugin cni failed to teardown pod &quot;calico-kube-controllers-577f77cb5c-99t8z_kube-system&quot; network: error getting ClusterInformation: Get &quot;https://[10.96.0.1]:443/apis/crd.projectcalico.org/v1/clusterinformations/default&quot;: dial tcp 10.96.0. 1:443: i/o timeout]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>原因：应该不是第一次初始化 k8s 集群，所以会遇到这样的问题。出现的原因是之前没有删除 k8s 的网络配置（文档里的每一步都有它存在的意义...）</p><p>解决：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf /etc/cni/net.d/  </span><span class="token comment" style="color:#999988;font-style:italic"># 删除网络配置</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># maybe需要重新init一下</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题三metrics-server一直无法成功"></a>问题三：metrics-server一直无法成功<a class="hash-link" href="#问题三metrics-server一直无法成功" title="Direct link to heading">#</a></h3><p>原因：master 没有加污点
解决：<code>kubectl taint nodes --all node-role.kubernetes.io/master node-role.kubernetes.io/master-</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题四10002-already-in-use"></a>问题四：10002 already in use<a class="hash-link" href="#问题四10002-already-in-use" title="Direct link to heading">#</a></h3><p><code>journalctl -u cloudcore.service -xe</code> 时看到 xxx already in use</p><p>原因：应该是之前的记录没有清理干净
解决：找到占用端口的进程，直接 Kill 即可</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">lsof</span><span class="token plain"> -i:xxxx</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> xxxxx</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题五edgecore-符号链接已存在"></a>问题五：edgecore 符号链接已存在<a class="hash-link" href="#问题五edgecore-符号链接已存在" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">execute keadm command failed:  failed to exec &#x27;bash -c sudo ln /etc/kubeedge/edgecore.service /etc/systemd/system/edgecore.service &amp;&amp; sudo systemctl daemon-reload &amp;&amp; sudo systemctl enable edgecore &amp;&amp; sudo systemctl start edgecore&#x27;, err: ln: failed to create hard link &#x27;/etc/systemd/system/edgecore.service&#x27;: File exists</span></span><span class="token-line" style="color:#393A34"><span class="token plain">, err: exit status 1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在尝试创建符号链接时，目标路径已经存在，因此无法创建。这通常是因为 <code>edgecore.service</code> 已经存在于 <code>/etc/systemd/system/</code> 目录中</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> /etc/systemd/system/edgecore.service</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题六缺少-tlsstreamcertfile"></a>问题六：缺少 TLSStreamCertFile<a class="hash-link" href="#问题六缺少-tlsstreamcertfile" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"> TLSStreamPrivateKeyFile: Invalid value: </span><span class="token string" style="color:#e3116c">&quot;/etc/kubeedge/certs/stream.key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> TLSStreamPrivateKeyFile not exist</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">12</span><span class="token plain">月 </span><span class="token number" style="color:#36acaa">14</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:02:23 cloud.kubeedge cloudcore</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">196229</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:   TLSStreamCertFile: Invalid value: </span><span class="token string" style="color:#e3116c">&quot;/etc/kubeedge/certs/stream.crt&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> TLSStreamCertFile not exist</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">12</span><span class="token plain">月 </span><span class="token number" style="color:#36acaa">14</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:02:23 cloud.kubeedge cloudcore</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">196229</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:   TLSStreamCAFile: Invalid value: </span><span class="token string" style="color:#e3116c">&quot;/etc/kubeedge/ca/streamCA.crt&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> TLSStreamCAFile not exist</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">12</span><span class="token plain">月 </span><span class="token number" style="color:#36acaa">14</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:02:23 cloud.kubeedge cloudcore</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">196229</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>查看 <code>/etc/kubeedge</code> 下是否有 <code>certgen.sh</code> 并且 <code>bash certgen.sh stream</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题七edgemesh-的-log-边边互联成功云边无法连接"></a>问题七：edgemesh 的 log 边边互联成功，云边无法连接<a class="hash-link" href="#问题七edgemesh-的-log-边边互联成功云边无法连接" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="排查"></a>排查<a class="hash-link" href="#排查" title="Direct link to heading">#</a></h4><p>先复习一下<strong>定位模型</strong>，确定<strong>被访问节点</strong>上的 edgemesh-agent(右)容器是否存在、是否处于正常运行中。</p><p><strong>这个情况是非常经常出现的</strong>，因为 master 节点一般都有污点，会驱逐其他 pod，进而导致 edgemesh-agent 部署不上去。这种情况可以通过去除节点污点，使 edgemesh-agent 部署上去解决。</p><p>如果访问节点和被访问节点的 edgemesh-agent 都正常启动了，但是还报这个错误，可能是因为访问节点和被访问节点没有互相发现导致，请这样排查：</p><ol><li>首先每个节点上的 edgemesh-agent 都具有 peer ID，比如</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">edge2: </span></span><span class="token-line" style="color:#393A34"><span class="token plain">I</span><span class="token string" style="color:#e3116c">&#x27;m {12D3KooWPpY4GqqNF3sLC397fMz5ZZfxmtMTNa1gLYFopWbHxZDt: [/ip4/127.0.0.1/tcp/20006 /ip4/192.168.1.4/tcp/20006]}</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c">
</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">edge1.kubeedge:</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">I&#x27;</span><span class="token plain">m </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">12D3KooWFz1dKY8L3JC8wAY6sJ5MswvPEGKysPCfcaGxFmeH7wkz: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">/ip4/127.0.0.1/tcp/20006 /ip4/192.168.1.2/tcp/20006</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">注意：</span></span><span class="token-line" style="color:#393A34"><span class="token plain">a. peer ID是根据节点名称哈希出来的，相同的节点名称会哈希出相同的peer ID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">b. 另外，节点名称不是服务器名称，是k8s </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> name，请用kubectl get nodes查看</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>2.如果访问节点和被访问节点处于同一个局域网内（<strong>所有节点应该具备内网 IP（10.0.0.0/8、172.16.0.0/12、192.168.0.0/16</strong>），请看<a href="https://zhuanlan.zhihu.com/p/585749690" target="_blank" rel="noopener noreferrer">全网最全EdgeMesh Q&amp;A手册 - 知乎 (zhihu.com)</a><strong>问题十二</strong>同一个局域网内 edgemesh-agent 互相发现对方时的日志是 <code>[MDNS] Discovery found peer: &lt;被访问端peer ID: [被访问端IP列表(可能会包含中继节点IP)]&gt;</code> ^d3939d</p><p>3.如果访问节点和被访问节点跨子网，这时候应该看看 relayNodes 设置的正不正确，为什么中继节点没办法协助两个节点交换 peer 信息。详细材料请阅读：<a href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/4whnkMM9oOaWRsI1ICsvSA" target="_blank" rel="noopener noreferrer">KubeEdge EdgeMesh 高可用架构详解</a>。跨子网的 edgemesh-agent 互相发现对方时的日志是 <code>[DHT] Discovery found peer: &lt;被访问端peer ID: [被访问端IP列表(可能会包含中继节点IP)]&gt;</code>（适用于我的情况）</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="解决"></a>解决<a class="hash-link" href="#解决" title="Direct link to heading">#</a></h4><p>在部署 edgemesh 进行 <code>kubectl apply -f build/agent/resources/</code> 操作时，修改 04-configmap，添加 relayNode（根本原因在于，不符合“访问节点和被访问节点处于同一个局域网内”，所以需要添加 relayNode）</p><p><img alt="Q7" src="/zh/assets/images/Q7-8146db94e6f201c47562da7a76cc6ab9.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题八master-的gpu-存在但是找不到-gpu-资源"></a>问题八：master 的gpu 存在但是找不到 gpu 资源<a class="hash-link" href="#问题八master-的gpu-存在但是找不到-gpu-资源" title="Direct link to heading">#</a></h3><p>主要针对的是服务器的情况，可以使用 <code>nvidia-smi</code> 查看显卡情况。</p><p>需要配置GPU支持</p><blockquote><p>[!quote][Installing the NVIDIA Container Toolkit — NVIDIA Container Toolkit 1.14.3 documentation](<a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#configuration" target="_blank" rel="noopener noreferrer">https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#configuration</a>)</p></blockquote><p>按上述内容进行配置，然后还需要 <code>vim /etc/docker/daemon.json</code>，添加 default-runtime。按照 quote 的内容设置后会有“runtimes”但是 default-runtime 不会设置，可能会导致找不到 GPU 资源</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;exec-opts&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;native.cgroupdriver=systemd&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;registry-mirrors&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;https://b9pmyelo.mirror.aliyuncs.com&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;default-runtime&quot;: &quot;nvidia&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;runtimes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;nvidia&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;args&quot;: [],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;path&quot;: &quot;nvidia-container-runtime&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题九jeston-的-gpu-存在但是找不到-gpu-资源"></a>问题九：jeston 的 gpu 存在但是找不到 gpu 资源<a class="hash-link" href="#问题九jeston-的-gpu-存在但是找不到-gpu-资源" title="Direct link to heading">#</a></h3><p>理论上 <code>k8s-device-plugin</code> 已经支持了 tegra 即 jetson 系列板子，会在查看 GPU 之前判断是否是 tegra 架构，如果是则采用 tegra 下查看 GPU 的方式（原因在 [[#GPU 支持]]里 quote 过了 ），但是很奇怪的是明明是 tegra 的架构却没有检测到：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/01/04 07:43:58 Retreiving plugins.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/01/04 07:43:58 Detected non-NVML platform: could not load NVML: libnvidia-ml.so.1: cannot </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"> shared object file: No such </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> or directory</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/01/04 07:43:58 Detected non-Tegra platform: /sys/devices/soc0/family </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> not found</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/01/04 07:43:58 Incompatible platform detected</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/01/04 07:43:58 If this is a GPU node, did you configure the NVIDIA Container Toolkit?</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/01/04 07:43:58 You can check the prerequisites at: https://github.com/NVIDIA/k8s-device-plugin</span><span class="token comment" style="color:#999988;font-style:italic">#prerequisites</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/01/04 07:43:58 You can learn how to </span><span class="token builtin class-name">set</span><span class="token plain"> the runtime at: https://github.com/NVIDIA/k8s-device-plugin</span><span class="token comment" style="color:#999988;font-style:italic">#quick-start</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/01/04 07:43:58 If this is not a GPU node, you should </span><span class="token builtin class-name">set</span><span class="token plain"> up a toleration or nodeSelector to only deploy this plugin on GPU nodes</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">/01/04 07:43:58 No devices found. Waiting indefinitely.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><img alt="Q9-1" src="/zh/assets/images/Q9-1-7d0151af41d7e0fcc09e05810fef0580.png"></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ dpkg -l </span><span class="token string" style="color:#e3116c">&#x27;*nvidia*&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><img alt="Q9-2" src="/zh/assets/images/Q9-2-7da49098d112b131753b39531fdc55aa.png"></p><p><img alt="Q9-3" src="/zh/assets/images/Q9-3-591f4e53eb2b30e79c052d9cc8a342d2.png"></p><blockquote><p>[!quote][Plug in does not detect Tegra device Jetson Nano · Issue #377 · NVIDIA/k8s-device-plugin (github.com)](<a href="https://github.com/NVIDIA/k8s-device-plugin/issues/377" target="_blank" rel="noopener noreferrer">https://github.com/NVIDIA/k8s-device-plugin/issues/377</a>)</p><p>Note that looking at the initial logs that you provided you may have been using <code>v1.7.0</code> of the NVIDIA Container Toolkit. This is quite an old version and we greatly improved our support for Tegra-based systems with the <code>v1.10.0</code> release. It should also be noted that in order to use the GPU Device Plugin on Tegra-based systems (specifically targetting the integrated GPUs) at least <code>v1.11.0</code> of the NVIDIA Container Toolkit is required.</p><p>There are no Tegra-specific changes in the <code>v1.12.0</code> release, so using the <code>v1.11.0</code> release should be sufficient in this case.</p></blockquote><p>那么应该需要升级<strong>NVIDIA Container Toolkit</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -fsSL https://nvidia.github.io/libnvidia-container/gpgkey </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /etc/apt/sources.list.d/nvidia-container-toolkit.list</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y nvidia-container-toolkit</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题十lc12700-5353-no-such-hostconnection-refused"></a>问题十：lc127.0.0. 53:53 no such host/connection refused<a class="hash-link" href="#问题十lc12700-5353-no-such-hostconnection-refused" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="问题描述"></a>问题描述<a class="hash-link" href="#问题描述" title="Direct link to heading">#</a></h4><p>在安装Sedna阶段，检查正确性时报错lc127.0.0. 53:53 no such host/connection refused</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="解决方法"></a>解决方法<a class="hash-link" href="#解决方法" title="Direct link to heading">#</a></h4><p>错误原理参见：<a href="https://zhuanlan.zhihu.com/p/585749690" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/585749690</a>  链接中的问题五。</p><p>首先，检查准备阶段中的Sedna安装脚本install.sh，观察其中是否有Hostnetwork键值对，如果没有，一般说明不会有问题。</p><p>如果确认没有这个键值对却依然报错，按照如下方法暂时解决问题（不推荐）：</p><p>（1）在边/云（取决于是哪一个sedna的pod出问题了）用vim /etc/resolv.conf打开文件，然后在文件最后一行添加nameserver 169.254.96.16，哪怕文件中本来就有nameserver键。但是一般不推荐这样做。</p><p>（2）再去边端用vim /etc/kubeedge/config/edgecore.yam打开edgecore.yaml，查看edge部分的clusterDNS内是否对应169.254.96.16，有没有被覆盖。如果没覆盖就成功。</p><p>（3）在这之后，如果是边端上的pod出问题，就要重装sedna，先delete再create。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="原解决方法"></a>原解决方法：<a class="hash-link" href="#原解决方法" title="Direct link to heading">#</a></h4><p>原因：解析 gm.sedna 这个域名失败</p><ol><li>如果安装 sedna 脚本有将 hostNetwork 去掉，则检查 edgecore.yaml 的 clusterDNS 部分，<strong>着重注意是否没有二次设置然后被后设置的覆盖掉</strong></li><li>如果没有将 hostNetwork 去掉，则将宿主机的 <code>/etc/resolv.conf</code> 添加 <code>nameserver 169.254.96.16</code></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题十一1692549616no-such-host"></a>问题十一：169.254.96.16:no such host<a class="hash-link" href="#问题十一1692549616no-such-host" title="Direct link to heading">#</a></h3><p>检查 edgemesh 的配置是否正确：</p><ol><li>检查 iptables 的链的顺序如<a href="https://edgemesh.netlify.app/zh/advanced/hybird-proxy.html" target="_blank" rel="noopener noreferrer">混合代理 | EdgeMesh</a> 所示</li><li>着重检查 clusterDNS</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题十二-kubectl-logs-pod-name-超时"></a>问题十二： <code>kubectl logs &lt;pod-name&gt;</code> 超时<a class="hash-link" href="#问题十二-kubectl-logs-pod-name-超时" title="Direct link to heading">#</a></h3><p><img alt="Q12-1" src="/zh/assets/images/Q12-1-60f1a6a94ca2026686a35355f721293d.png"></p><p>原因：借鉴 <a href="https://zhuanlan.zhihu.com/p/379962934" target="_blank" rel="noopener noreferrer">Kubernetes 边缘节点抓不到监控指标？试试这个方法！ - 知乎 (zhihu.com)</a></p><p><img alt="Q12-2" src="/zh/assets/images/Q12-2-f993592abf40687d45bb005fd2b6ed1c.png"></p><p>可以发现报错访问的端口就是 10350，而在 kubeedge 中 10350 应该会进行转发，所以应该是 cloudcore 的设置问题。</p><p>解决：<a href="https://kubeedge.io/docs/advanced/debug/" target="_blank" rel="noopener noreferrer">Enable Kubectl logs/exec to debug pods on the edge | KubeEdge</a> 根据这个链接设置即可。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题十三-kubectl-logs-pod-name-卡住"></a>问题十三： <code>kubectl logs &lt;pod-name&gt;</code> 卡住<a class="hash-link" href="#问题十三-kubectl-logs-pod-name-卡住" title="Direct link to heading">#</a></h3><p>可能的原因：之前 <code>kubectl logs</code> 时未结束就 ctrl+c 结束了导致后续卡住
解决：重启 edgecore/cloudcore <code>systemctl restart edgecore.service</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题十四cloudcore报certficate错误"></a>问题十四：CloudCore报certficate错误<a class="hash-link" href="#问题十四cloudcore报certficate错误" title="Direct link to heading">#</a></h3><p><img alt="Q14" src="/zh/assets/images/Q14-6d45356896d3c46128f949c4ca662ba4.png"></p><p>原因：因为是重装，主节点 token 变了，但是边缘节点一直以过去的 token 尝试进行连接</p><p>解决：边端用新的 token 连接就好</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题十五删除命名空间卡在-terminating"></a>问题十五：删除命名空间卡在 terminating<a class="hash-link" href="#问题十五删除命名空间卡在-terminating" title="Direct link to heading">#</a></h3><p>理论上一直等待应该是可以的(但是我等了半个钟也没成功啊!!)
<strong>方法一</strong>，但是没啥用，依旧卡住</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete ns sedna --force --grace-period</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>方法二</strong>：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">开启一个代理终端</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl proxy</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting to serve on </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:8001</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">再开启一个操作终端</span></span><span class="token-line" style="color:#393A34"><span class="token plain">将test namespace的配置文件输出保存</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get ns sedna -o json </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> sedna.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">删除spec及status部分的内容还有metadata字段后的</span><span class="token string" style="color:#e3116c">&quot;,&quot;</span><span class="token plain">号，切记！</span></span><span class="token-line" style="color:#393A34"><span class="token plain">剩下内容大致如下</span></span><span class="token-line" style="color:#393A34"><span class="token plain">guest@cloud:~/yby$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> sedna.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;kind&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Namespace&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;metadata&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;creationTimestamp&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-12-14T09:12:13Z&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;deletionTimestamp&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-12-14T09:15:25Z&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;managedFields&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;fieldsType&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FieldsV1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;fieldsV1&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;f:status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token string" style="color:#e3116c">&quot;f:phase&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;manager&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kubectl-create&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;operation&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Update&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-12-14T09:12:13Z&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;fieldsType&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FieldsV1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;fieldsV1&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;f:status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token string" style="color:#e3116c">&quot;f:conditions&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;k:{</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">type</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">NamespaceContentRemaining</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">}&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:lastTransitionTime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:message&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:reason&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;k:{</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">type</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">NamespaceDeletionContentFailure</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">}&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:lastTransitionTime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:message&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:reason&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;k:{</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">type</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">NamespaceDeletionDiscoveryFailure</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">}&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:lastTransitionTime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:message&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:reason&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;k:{</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">type</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">NamespaceDeletionGroupVersionParsingFailure</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">}&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:lastTransitionTime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:message&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:reason&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;k:{</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">type</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">NamespaceFinalizersRemaining</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">}&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:lastTransitionTime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:message&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:reason&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token string" style="color:#e3116c">&quot;f:type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;manager&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kube-controller-manager&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;operation&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Update&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-12-14T09:15:30Z&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sedna&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;resourceVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3351515&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;uid&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;99cb8afb-a4c1-45e6-960d-ff1b4894773d&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">调接口删除</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># curl -k -H &quot;Content-Type: application/json&quot; -X PUT --data-binary @sedna.json http://127.0.0.1:8001/api/v1/namespaces/sedna/finalize</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;kind&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Namespace&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;metadata&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sedna&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;uid&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;99cb8afb-a4c1-45e6-960d-ff1b4894773d&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;resourceVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3351515&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;creationTimestamp&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-12-14T09:12:13Z&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;deletionTimestamp&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-12-14T09:15:25Z&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;managedFields&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;manager&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;curl&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;operation&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Update&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-12-14T09:42:38Z&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;fieldsType&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FieldsV1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;fieldsV1&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;f:status&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;f:phase&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;spec&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;phase&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Terminating&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;conditions&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NamespaceDeletionDiscoveryFailure&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;True&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;lastTransitionTime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-12-14T09:15:30Z&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;reason&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;DiscoveryFailed&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Discovery failed for some groups, 1 failing: unable to retrieve the complete list of server APIs: metrics.k8s.io/v1beta1: the server is currently unable to handle the request&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NamespaceDeletionGroupVersionParsingFailure&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;False&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;lastTransitionTime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-12-14T09:15:30Z&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;reason&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ParsedGroupVersions&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;All legacy kube types successfully parsed&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NamespaceDeletionContentFailure&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;False&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;lastTransitionTime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-12-14T09:15:30Z&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;reason&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ContentDeleted&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;All content successfully deleted, may be waiting on finalization&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NamespaceContentRemaining&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;False&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;lastTransitionTime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-12-14T09:15:30Z&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;reason&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ContentRemoved&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;All content successfully removed&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NamespaceFinalizersRemaining&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;False&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;lastTransitionTime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-12-14T09:15:30Z&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;reason&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ContentHasNoFinalizers&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;All content-preserving finalizers finished&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题十六强制删除-pod-之后部署不成功"></a>问题十六：强制删除 pod 之后部署不成功<a class="hash-link" href="#问题十六强制删除-pod-之后部署不成功" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="问题描述-1"></a>问题描述<a class="hash-link" href="#问题描述-1" title="Direct link to heading">#</a></h4><p>因为现在 edge 的 pod 是通过创建 deployment 由 deployment 进行创建，但是通过 <code>kubectl delete deploy &lt;deploy-name&gt;</code> 删除 deployment 后，pod 一直卡在了 terminating 状态，于是采用了 <code>kubectl delete pod edgeworker-deployment-7g5hs-58dffc5cd7-b77wz --force --grace-period=0</code> 命令进行了删除。
然后发现重新部署时候发现 assigned to edge 的 pod 都卡在 pending 状态。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="解决-1"></a>解决<a class="hash-link" href="#解决-1" title="Direct link to heading">#</a></h4><p>因为--force 是不会实际终止运行的，所以本身原来的 docker 可能还在运行，现在的做法是手动去对应的边缘节点上删除对应的容器（包括 pause，关于 pause 可以看这篇文章<a href="https://zhuanlan.zhihu.com/p/464712164" target="_blank" rel="noopener noreferrer">大白话 K8S（03）：从 Pause 容器理解 Pod 的本质 - 知乎 (zhihu.com)</a>），然后重启 edgecore: <code>systemctl restart edgecore.service</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题十七删除-deploymentpod-等容器依旧自动重启"></a>问题十七：删除 deployment、pod 等，容器依旧自动重启<a class="hash-link" href="#问题十七删除-deploymentpod-等容器依旧自动重启" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"> journalctl -u edgecore.service  -f</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><img alt="Q17" src="/zh/assets/images/Q17-669c6d2f79f3164af4465da5421337b5.png"></p><p>解决：重启 edgecore</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart edgecore.service</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题十八大面积-evicteddisk-pressure"></a>问题十八：大面积 Evicted（disk pressure）<a class="hash-link" href="#问题十八大面积-evicteddisk-pressure" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="原因"></a>原因<a class="hash-link" href="#原因" title="Direct link to heading">#</a></h4><ul><li><p>node 上的 kubelet 负责采集资源占用数据，并和预先设置的 threshold 值进行比较，如果超过 threshold 值，kubelet 会杀掉一些 Pod 来回收相关资源，<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fkubernetes.io%2Fdocs%2Ftasks%2Fadminister-cluster%2Fout-of-resource%2F" target="_blank" rel="noopener noreferrer">K8sg官网解读kubernetes配置资源不足处理</a></p></li><li><p>默认启动时，node 的可用空间低于15%的时候，该节点上讲会执行 eviction 操作，由于磁盘已经达到了85%,在怎么驱逐也无法正常启动就会一直重启，Pod 状态也是 pending 中</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="临时解决方法"></a>临时解决方法<a class="hash-link" href="#临时解决方法" title="Direct link to heading">#</a></h4></li><li><p>修改配置文件增加传参数,添加此配置项<code>--eviction-hard=nodefs.available&lt;5%</code></p></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">root@cloud:/usr/lib/systemd/system</span><span class="token comment" style="color:#999988;font-style:italic"># systemctl status kubelet</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">● kubelet.service - kubelet: The Kubernetes Node Agent</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     Loaded: loaded </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">/lib/systemd/system/kubelet.service</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> enabled</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> vendor preset: enabled</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Drop-In: /etc/systemd/system/kubelet.service.d</span></span><span class="token-line" style="color:#393A34"><span class="token plain">             └─10-kubeadm.conf</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     Active: active </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">running</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> since Fri </span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">-12-15 09:17:50 CST</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> 5min ago</span></span><span class="token-line" style="color:#393A34"><span class="token plain">       Docs: https://kubernetes.io/docs/home/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   Main PID: </span><span class="token number" style="color:#36acaa">1070209</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kubelet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tasks: </span><span class="token number" style="color:#36acaa">59</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">limit: </span><span class="token number" style="color:#36acaa">309024</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">     Memory: </span><span class="token number" style="color:#36acaa">67</span><span class="token plain">.2M</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     CGroup: /system.slice/kubelet.service</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>可以看到配置文件目录所在位置是 <code>/etc/systemd/system/kubelet.service.d</code>，配置文件是 <code>10-kubeadm.conf</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/systemd/system/kubelet.service.d/10-kubeadm.conf</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Environment</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Environment</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml --eviction-hard=nodefs.available&lt;5%&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">最后添加上--eviction-hard</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nodefs.available</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">5</span><span class="token plain">%</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>然后重启 kubelet</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl  restart kubelet</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>会发现可以正常部署了(只是应急措施，磁盘空间需要再清理)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题十九执行iptables-命令时发现系统不支持--dport选项"></a>问题十九：执行iptables 命令时发现系统不支持--dport选项。<a class="hash-link" href="#问题十九执行iptables-命令时发现系统不支持--dport选项" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="问题描述-2"></a>问题描述<a class="hash-link" href="#问题描述-2" title="Direct link to heading">#</a></h4><p>执行命令：iptables -t nat -A OUTPUT -p tcp --dport 10351 -j DNAT --to $CLOUDCOREIPS:10003</p><p>报错信息中指出系统不支持--dport选项，这是因为iptables版本不支持。</p><p>使用iptables -V查看版本，如果是iptables v1.8.7 (nf_tables)，说明问题出在这里，因为nf_tables版本不支持--dport选项。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="解决方法-1"></a>解决方法<a class="hash-link" href="#解决方法-1" title="Direct link to heading">#</a></h4><p>此时，使用sudo update-alternatives --config iptables命令可以切换版本，执行此命令会提供3个可供选择的版本，其中编号为1的就是legacy版本（必须用sudo权限才能切换成功）。切换成功后再在root模式下执行 iptables -t nat -A OUTPUT -p tcp --dport 10351 -j DNAT --to $CLOUDCOREIPS:10003，理想状态下无输出。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题二十执行完keadm-join再执行journalctl时报错token-format错误"></a>问题二十：执行完keadm join再执行journalctl时报错token format错误。<a class="hash-link" href="#问题二十执行完keadm-join再执行journalctl时报错token-format错误" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="问题描述-3"></a>问题描述<a class="hash-link" href="#问题描述-3" title="Direct link to heading">#</a></h4><p>执行命令：keadm join --cloudcore-ipport=114.212.81.11:10000 --kubeedge-version=1.9.2 --token=……之后，再执行journalctl -u edegecore.service -f命令后，报错信息指出token format有问题。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="解决方法-2"></a>解决方法<a class="hash-link" href="#解决方法-2" title="Direct link to heading">#</a></h4><p>此时要么是因为cloudcore.service重启后token变化导致keadm join中的token过时，要么是因为执行keadm join的时候token输入的不对。此时，首先在云端重新获取正确的token，然后在边端从keadm reset开始重新执行一系列操作。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题二十一重启edgecoreservice后再执行journalctl时报错mapping-error"></a>问题二十一：重启edgecore.service后再执行journalctl时报错mapping error<a class="hash-link" href="#问题二十一重启edgecoreservice后再执行journalctl时报错mapping-error" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="问题描述-4"></a>问题描述<a class="hash-link" href="#问题描述-4" title="Direct link to heading">#</a></h4><p>在执行EdgeMesh启动阶段，修改/etc/kubeedge/config/edgecore.yaml文件，再用systemctl restart edgecore.service重启服务，然后再执行journalctl -u edegecore.service -f命令后，报错信息指出当前存在mapping error，以及yaml无法转化为json。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="解决方法-3"></a>解决方法<a class="hash-link" href="#解决方法-3" title="Direct link to heading">#</a></h4><p>检查是不是/etc/kubeedge/config/edgecore.yaml文件内的格式有问题。yaml文件中不能用tab缩进，必需用空格。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题二十二重启edgecoreservice后再执行journalctl时报错connect-refuse"></a>问题二十二：重启edgecore.service后再执行journalctl时报错connect refuse<a class="hash-link" href="#问题二十二重启edgecoreservice后再执行journalctl时报错connect-refuse" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="问题描述-5"></a>问题描述<a class="hash-link" href="#问题描述-5" title="Direct link to heading">#</a></h4><p>在执行EdgeMesh启动阶段，修改/etc/kubeedge/config/edgecore.yaml文件，再用systemctl restart edgecore.service重启服务，然后再执行journalctl -u edegecore.service -f命令后，报错信息指出connect refuse，云端拒绝通信。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="解决方法-4"></a>解决方法<a class="hash-link" href="#解决方法-4" title="Direct link to heading">#</a></h4><p>检查是不是因为云端cloudcore有问题。首先用systemctl status cloudcore查看云端状态，确保其正常运行；然后用systemctl restart cloudcore.service重启服务，并在重启后journalctl -u cloudcore.service -f查看报错信息。此时，很有可能发现问题四：journalclt -u cloudcore.service -xe 时看到 xxx already in use
原因：应该是之前的记录没有清理干净（一般是占用了10002端口）
解决：找到占用端口的进程，直接 Kill 即可
lsof -i:xxxx
kill xxxxx</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题二十三部署metrics-service时遇到shutting-down相关问题"></a>问题二十三：部署metrics-service时遇到Shutting down相关问题<a class="hash-link" href="#问题二十三部署metrics-service时遇到shutting-down相关问题" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="问题描述-6"></a>问题描述<a class="hash-link" href="#问题描述-6" title="Direct link to heading">#</a></h4><p>部署metrics-service过程中按照文档中修改components.yaml文件中端口号为4443，而后续metrics-service运行失败，
产生Shutting down RequestHeaderAuthRequestController等相关错误。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="解决方法-5"></a>解决方法<a class="hash-link" href="#解决方法-5" title="Direct link to heading">#</a></h4><p>在部署kubeedge时，metrics-service参数中暴露的端口会被自动覆盖为10250端口，components.yaml文件中后续实际服务
所在的端口一致。也可以手动修改参数中的端口为10250即可。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题二十四16925496-1653-io-timeout"></a>问题二十四：169.254.96. 16:53: i/o timeout<a class="hash-link" href="#问题二十四16925496-1653-io-timeout" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="问题描述-7"></a>问题描述<a class="hash-link" href="#问题描述-7" title="Direct link to heading">#</a></h4><p>集群新加入节点，KubeEdge的edgemesh以及sedna等组件会自动部署。查看lc的log会发现报错</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">client tries to connect global manager(address: gm.sedna:9000) failed, error: dial tcp: lookup gm.sedna on 169.254.96.16:53: read udp 172.17.0.3:49991-&gt;169.254.96.16:53: i/o timeout</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="解决方法-6"></a>解决方法<a class="hash-link" href="#解决方法-6" title="Direct link to heading">#</a></h4><p>由于是pod与edgemesh-agent的交互问题，首先检查该edge上的edgemesh-agent的状态，发现会是edgemesh-agent的问题。
<img alt="Q24-1" src="/zh/assets/images/Q24-1-b02734af65fce88ec4459259d817bc36.png"></p><p>通过describe pod发现该pod被分配到新edge后就没有其余事件记录</p><p><img alt="Q24-2" src="/zh/assets/images/Q24-2-b2316d2cf4ee1288f5324df9a0da9876.png"></p><p>可以去edge上查看信息。通过<code>journalctl -u edgecore.service -xe</code>可以看到相关报错</p><p><img alt="Q24-3" src="/zh/assets/images/Q24-3-af894ddc03e47d6514186c0bb7f079ba.png"></p><p>原因：docker国内无法访问，新加入的edge没有做对应配置，导致拉取不到 kubeedge/edgemesh-agent 镜像。配置后重启docker和edgecore即可。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="问题二十五边端join报错"></a>问题二十五：边端join报错<a class="hash-link" href="#问题二十五边端join报错" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="问题描述-8"></a>问题描述<a class="hash-link" href="#问题描述-8" title="Direct link to heading">#</a></h4><p>边端执行keadm join报错</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="解决方法-7"></a>解决方法<a class="hash-link" href="#解决方法-7" title="Direct link to heading">#</a></h4><p>检查edgecore.yaml文件</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/kubeedge/config/edgecore.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><img alt="Q25" src="/zh/assets/images/Q25-dc68c2dfac16a206d5fd83e3a9d1ba11.png"></p><p>edgeHub中的httpServer添加云端地址，例如<a href="https://114.212.81.11:10002" target="_blank" rel="noopener noreferrer">https://114.212.81.11:10002</a> ，websocket中的server删除最开始的冒号</p><p>修改完后重新运行keadm join指令。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/docs/getting-start/installation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Installation</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh/docs/developer-guide/how-to-build"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to Build »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#问题一kube-proxy-报-iptables-问题" class="table-of-contents__link">问题一：kube-proxy 报 iptables 问题</a></li><li><a href="#问题二calico-和-coredns-一直处于初始化" class="table-of-contents__link">问题二：calico 和 coredns 一直处于初始化</a></li><li><a href="#问题三metrics-server一直无法成功" class="table-of-contents__link">问题三：metrics-server一直无法成功</a></li><li><a href="#问题四10002-already-in-use" class="table-of-contents__link">问题四：10002 already in use</a></li><li><a href="#问题五edgecore-符号链接已存在" class="table-of-contents__link">问题五：edgecore 符号链接已存在</a></li><li><a href="#问题六缺少-tlsstreamcertfile" class="table-of-contents__link">问题六：缺少 TLSStreamCertFile</a></li><li><a href="#问题七edgemesh-的-log-边边互联成功云边无法连接" class="table-of-contents__link">问题七：edgemesh 的 log 边边互联成功，云边无法连接</a></li><li><a href="#问题八master-的gpu-存在但是找不到-gpu-资源" class="table-of-contents__link">问题八：master 的gpu 存在但是找不到 gpu 资源</a></li><li><a href="#问题九jeston-的-gpu-存在但是找不到-gpu-资源" class="table-of-contents__link">问题九：jeston 的 gpu 存在但是找不到 gpu 资源</a></li><li><a href="#问题十lc12700-5353-no-such-hostconnection-refused" class="table-of-contents__link">问题十：lc127.0.0. 53:53 no such host/connection refused</a></li><li><a href="#问题十一1692549616no-such-host" class="table-of-contents__link">问题十一：169.254.96.16:no such host</a></li><li><a href="#问题十二-kubectl-logs-pod-name-超时" class="table-of-contents__link">问题十二： <code>kubectl logs &lt;pod-name&gt;</code> 超时</a></li><li><a href="#问题十三-kubectl-logs-pod-name-卡住" class="table-of-contents__link">问题十三： <code>kubectl logs &lt;pod-name&gt;</code> 卡住</a></li><li><a href="#问题十四cloudcore报certficate错误" class="table-of-contents__link">问题十四：CloudCore报certficate错误</a></li><li><a href="#问题十五删除命名空间卡在-terminating" class="table-of-contents__link">问题十五：删除命名空间卡在 terminating</a></li><li><a href="#问题十六强制删除-pod-之后部署不成功" class="table-of-contents__link">问题十六：强制删除 pod 之后部署不成功</a></li><li><a href="#问题十七删除-deploymentpod-等容器依旧自动重启" class="table-of-contents__link">问题十七：删除 deployment、pod 等，容器依旧自动重启</a></li><li><a href="#问题十八大面积-evicteddisk-pressure" class="table-of-contents__link">问题十八：大面积 Evicted（disk pressure）</a></li><li><a href="#问题十九执行iptables-命令时发现系统不支持--dport选项" class="table-of-contents__link">问题十九：执行iptables 命令时发现系统不支持--dport选项。</a></li><li><a href="#问题二十执行完keadm-join再执行journalctl时报错token-format错误" class="table-of-contents__link">问题二十：执行完keadm join再执行journalctl时报错token format错误。</a></li><li><a href="#问题二十一重启edgecoreservice后再执行journalctl时报错mapping-error" class="table-of-contents__link">问题二十一：重启edgecore.service后再执行journalctl时报错mapping error</a></li><li><a href="#问题二十二重启edgecoreservice后再执行journalctl时报错connect-refuse" class="table-of-contents__link">问题二十二：重启edgecore.service后再执行journalctl时报错connect refuse</a></li><li><a href="#问题二十三部署metrics-service时遇到shutting-down相关问题" class="table-of-contents__link">问题二十三：部署metrics-service时遇到Shutting down相关问题</a></li><li><a href="#问题二十四16925496-1653-io-timeout" class="table-of-contents__link">问题二十四：169.254.96. 16:53: i/o timeout</a></li><li><a href="#问题二十五边端join报错" class="table-of-contents__link">问题二十五：边端join报错</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/introduction/why-dayu">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/dayu-autostreamer/dayu/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github Issue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/dayu-autostreamer/dayu" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 The Dayu Authors. All rights reserved.</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.eaeab0d0.js"></script>
<script src="/zh/assets/js/main.c5dadaff.js"></script>
</body>
</html>