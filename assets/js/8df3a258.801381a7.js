"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4908],{413:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"getting-started/install-lower-layer-system/install-kubeedge","title":"Install KubeEdge","description":"Download keadm (both cloud/edge)","source":"@site/docs/03-getting-started/02-install-lower-layer-system/03-install-kubeedge.md","sourceDirName":"03-getting-started/02-install-lower-layer-system","slug":"/getting-started/install-lower-layer-system/install-kubeedge","permalink":"/docs/getting-started/install-lower-layer-system/install-kubeedge","draft":false,"unlisted":false,"editUrl":"https://github.com/dayu-autostreamer/dayu-autostreamer.github.io/tree/main/docs/03-getting-started/02-install-lower-layer-system/03-install-kubeedge.md","tags":[],"version":"current","lastUpdatedBy":"onecheck","lastUpdatedAt":1769521345000,"sidebarPosition":3,"frontMatter":{"sidebar_label":"Install KubeEdge","slug":"/getting-started/install-lower-layer-system/install-kubeedge"},"sidebar":"tutorialSidebar","previous":{"title":"Install Kubernetes","permalink":"/docs/getting-started/install-lower-layer-system/install-kubernetes"},"next":{"title":"Install EdgeMesh","permalink":"/docs/getting-started/install-lower-layer-system/install-edgemesh"}}');var s=t(4848),r=t(8453);const l={sidebar_label:"Install KubeEdge",slug:"/getting-started/install-lower-layer-system/install-kubeedge"},o="Install KubeEdge",d={},c=[{value:"Download keadm (both cloud/edge)",id:"download-keadm-both-cloudedge",level:2},{value:"Start KubeEdge (cloud)",id:"start-kubeedge-cloud",level:2},{value:"Reset environment (Skip on first installation)",id:"reset-environment-skip-on-first-installation",level:3},{value:"Start cloudcore",id:"start-cloudcore",level:3},{value:"Configure cloudcore",id:"configure-cloudcore",level:3},{value:"Join KubeEdge cluster (edge)",id:"join-kubeedge-cluster-edge",level:2},{value:"Reset environment (Skip on first installation)",id:"reset-environment-skip-on-first-installation-1",level:3},{value:"Start edgecore",id:"start-edgecore",level:3},{value:"Set Jetpack label (Optional for Jetson devices)",id:"set-jetpack-label-optional-for-jetson-devices",level:2},{value:"Check apiserver address (edge)",id:"check-apiserver-address-edge",level:3},{value:"Create SA + RBAC (cloud)",id:"create-sa--rbac-cloud",level:3},{value:"Generate kubeconfig (cloud)",id:"generate-kubeconfig-cloud",level:3},{value:"Create secret (cloud)",id:"create-secret-cloud",level:3},{value:"Deploy daemonset (cloud)",id:"deploy-daemonset-cloud",level:3}];function i(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"install-kubeedge",children:"Install KubeEdge"})}),"\n",(0,s.jsx)(n.h2,{id:"download-keadm-both-cloudedge",children:"Download keadm (both cloud/edge)"}),"\n",(0,s.jsx)(n.p,{children:"keadm is mainly used for kubeedge management, installation, and usage."}),"\n",(0,s.jsxs)(n.p,{children:["Official release version link: ",(0,s.jsx)(n.a,{href:"https://github.com/kubeedge/kubeedge/releases/",children:"Release KubeEdge v1.9.2 release \xb7 kubeedge/kubeedge (github.com)"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check machine architecture\nuname -a\n# Download keadm with corresponding version and architecture\nwget https://github.com/kubeedge/kubeedge/releases/download/v1.9.2/keadm-v1.9.2-linux-amd64.tar.gz\n# Unzip\ntar zxvf keadm-v1.9.2-linux-amd64.tar.gz\n# Add execution permissions\nchmod +x keadm-v1.9.2-linux-amd64/keadm/keadm \n# Move to /usr/local/bin/\ncp keadm-v1.9.2-linux-amd64/keadm/keadm /usr/local/bin/\n"})}),"\n",(0,s.jsx)(n.h2,{id:"start-kubeedge-cloud",children:"Start KubeEdge (cloud)"}),"\n",(0,s.jsxs)(n.p,{children:["This step may occur ",(0,s.jsx)(n.a,{href:"/docs/getting-started/install-lower-layer-system/faqs#question-4-10002-already-in-use",children:"Question 4\uff1a10002 already in use"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"reset-environment-skip-on-first-installation",children:"Reset environment (Skip on first installation)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"keadm reset\n"})}),"\n",(0,s.jsx)(n.h3,{id:"start-cloudcore",children:"Start cloudcore"}),"\n",(0,s.jsx)(n.p,{children:"Start cloudcore by keadm."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Modify the ip address of '--adverse-address'\nkeadm init --advertise-address=114.212.81.11 --kubeedge-version=1.9.2\n\n# Open forwarding route\nkubectl get cm tunnelport -n kubeedge -o yaml\n# find '10350' or '10351' in the result\n\n# set CLOUDCOREIPS\nexport CLOUDCOREIPS=xxx.xxx.xxx.xxx\n# set 'dport' as previously 'tunnelport'\niptables -t nat -A OUTPUT -p tcp --dport 10351 -j DNAT --to $CLOUDCOREIPS:10003\n\ncd /etc/kubeedge/\n\n# or download manually from https://github.com/kubeedge/kubeedge/blob/master/build/tools/certgen.sh\nwget https://raw.githubusercontent.com/kubeedge/kubeedge/refs/heads/master/build/tools/certgen.sh\n\nbash certgen.sh stream\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configure-cloudcore",children:"Configure cloudcore"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"vim /etc/kubeedge/config/cloudcore.yaml\n\n# modify cloudcore.yaml \nmodules:\n  ..\n  cloudStream:\n    enable: true\n    streamPort: 10003\n  ..\n  dynamicController:\n    enable: true\n"})}),"\n",(0,s.jsx)(n.p,{children:"Restart cloudcore\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart cloudcore.service\n"})}),"\n",(0,s.jsx)(n.p,{children:"If restarting cloudcore fails, the solution is as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Place the generated 'cloudcore.service' under the folder managed by systemctl\ncp /etc/kubeedge/cloudcore.service /etc/systemd/system\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"journalctl -u cloudcore.service -xe"})," to check if cloudcore is running normally and there are no errors reported."]}),"\n",(0,s.jsx)(n.h2,{id:"join-kubeedge-cluster-edge",children:"Join KubeEdge cluster (edge)"}),"\n",(0,s.jsxs)(n.p,{children:["This step may occur ",(0,s.jsx)(n.a,{href:"/docs/getting-started/install-lower-layer-system/faqs#question-5-edgecore-file-exists",children:"Question 5\uff1aedgecore file exists"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["If ",(0,s.jsx)(n.code,{children:"keadm join"})," fails, you can retry from ",(0,s.jsx)(n.code,{children:"keadm reset"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"reset-environment-skip-on-first-installation-1",children:"Reset environment (Skip on first installation)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# reset\nkeadm reset\n\n# When rejoining, if an error was reported that there was a folder, just deleted directly.\nrm -rf /etc/kubeedge\n\n# Possible docker container occupancy (usually 'mqtt')\ndocker ps -a\ndocker stop mqtt\ndocker rm mqtt\n"})}),"\n",(0,s.jsx)(n.h3,{id:"start-edgecore",children:"Start edgecore"}),"\n",(0,s.jsx)(n.p,{children:"To start edgecore, you need to get token on the master node (cloud) first:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"keadm gettoken\n"})}),"\n",(0,s.jsx)(n.p,{children:"Execute on the edge:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Add IP address of the master here. The token here is obtained from the master\nkeadm join --cloudcore-ipport=114.212.81.11:10000 --kubeedge-version=1.9.2 --token=9e1832528ae701aba2c4f7dfb49183ab2487e874c8090e68c19c95880cd93b50.eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MTk1NjU4MzF9.1B4su4QwvQy_ZCPs-PIyDT9ixsDozfN1oG4vX59tKDs\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This step may occur ",(0,s.jsx)(n.a,{href:"/docs/getting-started/install-lower-layer-system/faqs#question-25-keadm-join-error-on-edge-nodes",children:"Question 25\uff1akeadm join error on edge nodes"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check for logs\njournalctl -u edgecore.service -f\n"})}),"\n",(0,s.jsx)(n.h2,{id:"set-jetpack-label-optional-for-jetson-devices",children:"Set Jetpack label (Optional for Jetson devices)"}),"\n",(0,s.jsx)(n.p,{children:"If the edge device is a Jetson device, you need to set the label for Jetpack version."}),"\n",(0,s.jsx)(n.h3,{id:"check-apiserver-address-edge",children:"Check apiserver address (edge)"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"curl"})," on edge devices to check apiserver address:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# replace MASTER_IP with the actual master (cloud) IP address\ncurl -k --max-time 3 https://MASTER_IP:6443/healthz\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If the response is ",(0,s.jsx)(n.code,{children:"ok"}),", the apiserver address is correct. If not, please check the network connection between the edge device and the cloud or the apiserver address."]}),"\n",(0,s.jsx)(n.h3,{id:"create-sa--rbac-cloud",children:"Create SA + RBAC (cloud)"}),"\n",(0,s.jsx)(n.p,{children:"Create a service account and cluster role binding for setting labels."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'kubectl -n kube-system create sa jetpack-node-labeler\n\nkubectl apply -f - <<\'YAML\'\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: jetpack-node-labeler\nrules:\n- apiGroups: [""]\n  resources: ["nodes"]\n  verbs: ["get","patch","update"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: jetpack-node-labeler\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: jetpack-node-labeler\nsubjects:\n- kind: ServiceAccount\n  name: jetpack-node-labeler\n  namespace: kube-system\nYAML\n'})}),"\n",(0,s.jsx)(n.h3,{id:"generate-kubeconfig-cloud",children:"Generate kubeconfig (cloud)"}),"\n",(0,s.jsx)(n.p,{children:"Get token on the cloud:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"SECRET=$(kubectl -n kube-system get sa jetpack-node-labeler -o jsonpath='{.secrets[0].name}')\nTOKEN=$(kubectl -n kube-system get secret \"$SECRET\" -o jsonpath='{.data.token}' | base64 -d)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Get CA cert on the cloud:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"CA_CRT=$(kubectl config view --raw -o jsonpath='{.clusters[0].cluster.certificate-authority-data}')\n"})}),"\n",(0,s.jsx)(n.p,{children:"Generate kubeconfig file on the cloud:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Replace MASTER_IP with actual master (cloud) IP address\nMASTER="https://MASTER_IP:6443"\n\ncat > jetpack-labeler.kubeconfig <<EOF\napiVersion: v1\nkind: Config\nclusters:\n- name: edge-cluster\n  cluster:\n    server: ${MASTER}\n    certificate-authority-data: ${CA_CRT}\nusers:\n- name: jetpack-node-labeler\n  user:\n    token: ${TOKEN}\ncontexts:\n- name: jetpack\n  context:\n    cluster: edge-cluster\n    user: jetpack-node-labeler\ncurrent-context: jetpack\nEOF\n'})}),"\n",(0,s.jsx)(n.h3,{id:"create-secret-cloud",children:"Create secret (cloud)"}),"\n",(0,s.jsxs)(n.p,{children:["Create a secret in the ",(0,s.jsx)(n.code,{children:"kube-system"})," namespace to store the kubeconfig file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl -n kube-system create secret generic jetpack-labeler-kubeconfig \\\n  --from-file=config=jetpack-labeler.kubeconfig \\\n  --dry-run=client -o yaml | kubectl apply -f -\n"})}),"\n",(0,s.jsx)(n.h3,{id:"deploy-daemonset-cloud",children:"Deploy daemonset (cloud)"}),"\n",(0,s.jsx)(n.p,{children:"Deploy the daemonset to set Jetpack labels:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'kubectl apply -f - <<\'YAML\'\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: jetpack-node-labeler\n  namespace: kube-system\nspec:\n  selector:\n    matchLabels:\n      app: jetpack-node-labeler\n  template:\n    metadata:\n      labels:\n        app: jetpack-node-labeler\n    spec:\n      serviceAccountName: jetpack-node-labeler\n      nodeSelector:\n        kubernetes.io/arch: arm64\n      tolerations:\n      - operator: Exists\n      volumes:\n      - name: host-etc\n        hostPath:\n          path: /etc\n          type: Directory\n      - name: kubeconfig\n        secret:\n          secretName: jetpack-labeler-kubeconfig\n      - name: tmp\n        emptyDir: {}\n      containers:\n      - name: labeler\n        image: bitnami/kubectl:latest\n        env:\n        - name: NODE_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: spec.nodeName\n        - name: KUBECONFIG\n          value: /kube/config\n        - name: HOME\n          value: /tmp\n        volumeMounts:\n        - name: host-etc\n          mountPath: /host/etc\n          readOnly: true\n        - name: kubeconfig\n          mountPath: /kube\n          readOnly: true\n        - name: tmp\n          mountPath: /tmp\n        command: ["/bin/sh","-c"]\n        args:\n        - |\n          set -eu\n\n          if [ ! -f /host/etc/nv_tegra_release ]; then\n            echo "Not a Jetson (no /etc/nv_tegra_release). Skip."\n            sleep 360000\n          fi\n\n          LINE="$(head -n 1 /host/etc/nv_tegra_release || true)"\n          L4T_MAJOR="$(echo "$LINE" | sed -n \'s/.*R\\([0-9]\\+\\).*/\\1/p\' | head -n1)"\n\n          JP="unknown"\n          case "$L4T_MAJOR" in\n            32) JP="4" ;;\n            35) JP="5" ;;\n            36) JP="6" ;;\n          esac\n\n          echo "node=$NODE_NAME L4T_MAJOR=$L4T_MAJOR -> JP=$JP"\n\n          kubectl label node "$NODE_NAME" \\\n            jetson.nvidia.com/jetpack.major="$JP" \\\n            jetson.nvidia.com/l4t.major="${L4T_MAJOR:-unknown}" \\\n            --overwrite\n\n          echo "label ok"\n          sleep 360000\nYAML\n'})}),"\n",(0,s.jsx)(n.p,{children:"Verify that the labels have been set correctly:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl -n kube-system get pod -l app=jetpack-node-labeler -o wide\nkubectl -n kube-system logs -l app=jetpack-node-labeler --tail=100\nkubectl get nodes -L jetson.nvidia.com/jetpack.major,jetson.nvidia.com/l4t.major\n"})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>o});var a=t(6540);const s={},r=a.createContext(s);function l(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);