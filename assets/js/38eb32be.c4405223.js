"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9823],{222:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/cloud-agent-ab2c8672aff704ecced4d31a17a3057f.png"},3229:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/api-f6783249e7bf0863bbbecc556bdd66ca.png"},3562:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/edge-agent-3f07a33653e8d7922c962bdd2acce216.png"},4409:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/iptables-06989a7c0522557bf3dbef641fa50e4d.png"},7766:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/edgecore1-3e8073fb438155d512871c86cc04524a.png"},8338:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"getting-started/install-lower-layer-system/install-edgemesh","title":"Install EdgeMesh","description":"EdgeMesh environment preparation (cloud)","source":"@site/docs/03-getting-started/02-install-lower-layer-system/04-install-edgemesh.md","sourceDirName":"03-getting-started/02-install-lower-layer-system","slug":"/getting-started/install-lower-layer-system/install-edgemesh","permalink":"/docs/getting-started/install-lower-layer-system/install-edgemesh","draft":false,"unlisted":false,"editUrl":null,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_label":"Install EdgeMesh","slug":"/getting-started/install-lower-layer-system/install-edgemesh","custom_edit_url":null},"sidebar":"tutorialSidebar","previous":{"title":"Install KubeEdge","permalink":"/docs/getting-started/install-lower-layer-system/install-kubeedge"},"next":{"title":"Install Sedna","permalink":"/docs/getting-started/install-lower-layer-system/install-sedna"}}');var l=s(4848),d=s(8453);const a={sidebar_label:"Install EdgeMesh",slug:"/getting-started/install-lower-layer-system/install-edgemesh",custom_edit_url:null},r="Install EdgeMesh",i={},c=[{value:"EdgeMesh environment preparation (cloud)",id:"edgemesh-environment-preparation-cloud",level:2},{value:"Start EdgeMesh (both cloud/edge)",id:"start-edgemesh-both-cloudedge",level:2},{value:"Deploy edgemesh-agent (cloud)",id:"deploy-edgemesh-agent-cloud",level:3},{value:"Configure edge network (edge)",id:"configure-edge-network-edge",level:3},{value:"Check running state",id:"check-running-state",level:3},{value:"Uninstall Edgemesh",id:"uninstall-edgemesh",level:3}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",...(0,d.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"install-edgemesh",children:"Install EdgeMesh"})}),"\n",(0,l.jsx)(n.h2,{id:"edgemesh-environment-preparation-cloud",children:"EdgeMesh environment preparation (cloud)"}),"\n",(0,l.jsxs)(n.p,{children:["This Step may occur ",(0,l.jsx)(n.a,{href:"/docs/getting-started/install-lower-layer-system/faqs#question-6-tlsstreamprivatekeyfile-not-exist",children:"Question 6\uff1aTLSStreamPrivateKeyFile not exist"})]}),"\n",(0,l.jsx)(n.p,{children:"Step 1: Remove the taint on the master node."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl taint nodes --all node-role.kubernetes.io/master-\n"})}),"\n",(0,l.jsx)(n.p,{children:"Step 2: Add filter tags to Kubernetes API services."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'kubectl label services kubernetes service.edgemesh.kubeedge.io/service-proxy-name=""\n'})}),"\n",(0,l.jsx)(n.p,{children:"Step 3: Enable Kube-API endpoint service of KubeEdge on edges."}),"\n",(0,l.jsxs)(n.p,{children:["On the cloud, enable ",(0,l.jsx)(n.code,{children:"dynamicController"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"vim /etc/kubeedge/config/cloudcore.yaml\n# Modify cloudcore.yaml\nmodules:\n  ..\n  cloudStream:\n    enable: true\n    streamPort: 10003\n  ..\n  dynamicController:\n    enable: true\n    \n# Restart cloucore\nsystemctl restart cloudcore.service\n"})}),"\n",(0,l.jsxs)(n.p,{children:["On the edges, enable ",(0,l.jsx)(n.code,{children:"metaServer"})," and ",(0,l.jsx)(n.code,{children:"edgeStream"})," (note that this operation should redo after ",(0,l.jsx)(n.code,{children:"keadm reset"}),")."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"vim /etc/kubeedge/config/edgecore.yaml\n# Modify edgecore.yaml\nedgeStream:  \n\tenable: true  \n\thandshakeTimeout: 30  \n\treadDeadline: 15  \n\tserver: 192.168.0.139:10004  \n\ttlsTunnelCAFile: /etc/kubeedge/ca/rootCA.crt  \n\ttlsTunnelCertFile: /etc/kubeedge/certs/server.crt  \n\ttlsTunnelPrivateKeyFile: /etc/kubeedge/certs/server.key  \n\twriteDeadline: 15\n...\nmetaManager:\n    metaServer:\n      enable: true\n...\n\n# Restart edgecore\nsystemctl restart edgecore.service\n# Check running state\njournalctl -u edgecore.service -f\n"})}),"\n",(0,l.jsx)(n.p,{children:"Step 4: On the edge, test whether the edge Kube-API endpoint functions normally."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Execute on edges\ncurl 127.0.0.1:10550/api/v1/services\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"api",src:s(3229).A+"",width:"2230",height:"655"})}),"\n",(0,l.jsx)(n.p,{children:"If the return value is an empty list, or it takes a long time (close to 10 seconds) to receive the return value, it indicates that there may be an error in the configuration, please check it carefully."}),"\n",(0,l.jsx)(n.h2,{id:"start-edgemesh-both-cloudedge",children:"Start EdgeMesh (both cloud/edge)"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"This is a hot spot for problems, when encountering issues, please refer to the EdgeMesh official manual for troubleshooting:"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://edgemesh.netlify.app/zh/guide/#%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85",children:"\u5feb\u901f\u4e0a\u624b | EdgeMesh"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/585749690",children:"\u5168\u7f51\u6700\u5168EdgeMesh Q&A\u624b\u518c - \u77e5\u4e4e (zhihu.com)"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"deploy-edgemesh-agent-cloud",children:"Deploy edgemesh-agent (cloud)"}),"\n",(0,l.jsx)(n.p,{children:"Download edgemesh code:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# clone edgemesh code (customized by dayu)\ngit clone https://github.com/dayu-autostreamer/dayu-edgemesh.git\n# move in code directory\ncd dayu-edgemesh\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Add ",(0,l.jsx)(n.code,{children:"relay node"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"vim build/agent/resources/04-configmap.yaml\n# Add the master node (cloud) as relay node for cloud-edge communication\uff1a\n....\nedgeTunnel:\n        enable: true\n        relayNodes:\n        - nodeName: <hostname>\n          advertiseAddress:\n          - <ip>\n....\n# Fulfill <hostname> <ip> with hostname and ip of the cloud.\n"})}),"\n",(0,l.jsx)(n.p,{children:"Deploy edgemesh:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Deploy crd files\nkubectl apply -f build/crds/istio/\n# Deploy edgemesh-agent\nkubectl apply -f build/agent/resources/\n"})}),"\n",(0,l.jsxs)(n.p,{children:["NOTE: If using the ",(0,l.jsx)(n.a,{href:"/docs/developer-guide/how-to-build/docker-registry/",children:"Intranet Image Repository"}),", please modify the image in the yaml file, such as:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"dayuhub/edgemesh-gateway:v1.0 -> repo:5000/dayuhub/edgemesh-gateway:v1.0\n"})}),"\n",(0,l.jsx)(n.h3,{id:"configure-edge-network-edge",children:"Configure edge network (edge)"}),"\n",(0,l.jsx)(n.p,{children:"Configure the edge:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"vim /etc/kubeedge/config/edgecore.yaml\n# Modify edgecore.yaml\nedged:\n    clusterDNS: 169.254.96.16\n    clusterDomain: cluster.local\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"edgecore",src:s(7766).A+"",width:"687",height:"403"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"edgecore",src:s(8973).A+"",width:"404",height:"187"})}),"\n",(0,l.jsx)(n.p,{children:"Restart edgecore:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"systemctl restart edgecore\n"})}),"\n",(0,l.jsx)(n.h3,{id:"check-running-state",children:"Check running state"}),"\n",(0,l.jsx)(n.p,{children:"Check iptables state:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"iptables -t nat -nvL\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"iptables",src:s(4409).A+"",width:"2148",height:"478"})}),"\n",(0,l.jsx)(n.p,{children:"Check the state of edgemesh pods:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n kubeedge\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"normal-run",src:s(9873).A+"",width:"949",height:"351"})}),"\n",(0,l.jsx)(n.p,{children:"Logs on the cloud\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl logs -n kubeedge [pod-name]\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"cloud-agent",src:s(222).A+"",width:"2031",height:"1014"})}),"\n",(0,l.jsx)(n.p,{children:"Logs on the edge\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Check edgemesh logs on the edge\nkubectl logs -n kubeedge [pod-name]\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"edge-agent.png",src:s(3562).A+"",width:"2234",height:"1212"})}),"\n",(0,l.jsx)(n.h3,{id:"uninstall-edgemesh",children:"Uninstall Edgemesh"}),"\n",(0,l.jsx)(n.p,{children:"If you need to reinstall Edgemesh, please uninstall it first."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"cd dayu-edgemesh\nkubectl delete -f build/crds/istio/\nkubectl delete -f build/agent/resources/\n"})})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>r});var t=s(6540);const l={},d=t.createContext(l);function a(e){const n=t.useContext(d);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),t.createElement(d.Provider,{value:n},e.children)}},8973:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/edgecore2-0dee8843ad287e185502c1cd99d41365.png"},9873:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/EdgeMeshNormalRun-f302a5160c96e980c2952a371a4ee23c.jpg"}}]);